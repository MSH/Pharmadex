<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:pe="http://primefaces.org/ui/extensions"
                template="../templates/admin_layout.xhtml">
<ui:define name="content">
<div class="post">
    <h1 class="title ui-widget-header ui-corner-all"> #{msgs.product_reg}</h1>
</div>

<h:form id="reghome">
<p:growl id="growl" showSummary="true"/>
<pe:ajaxErrorHandler/>

<p:wizard widgetVar="wizard" showNavBar="false" flowListener="#{regHomeMbean.onFlowProcess}">
<p:tab id="prodreg" title="#{msgs.applicant_detail}">

    <ui:include src="appinfosub.xhtml"/>

    <div align="right">
        <p:commandButton value="#{msgs.global_cancel}" immediate="true" action="#{regHomeMbean.cancel}"
                         ajax="false"/>
        <p:commandButton value="#{msgs.next}" onclick="wizard.next();"/>
    </div>

</p:tab>

<p:tab id="proddetails" title="#{msgs.product_details}">
    <p:panel header="#{msgs.product_details}">

        <ui:include src="proddetails.xhtml"/>

        <div align="right">
            <p:commandButton value="#{msgs.global_save}" action="#{regHomeMbean.saveApp}"
                             update=":reghome :reghome:growl" ajax="false"/>
            <p:commandButton value="#{msgs.global_cancel}" immediate="true" action="#{regHomeMbean.cancel}"
                             ajax="false"/>
            <p:commandButton value="#{msgs.prev}" onclick="wizard.back();"/>
            <p:commandButton value="#{msgs.next}" onclick="wizard.next();"/>
        </div>
    </p:panel>
</p:tab>


<p:tab id="appdetails" title="#{msgs.application_detail}">
    <p:panel header="#{msgs.application_detail}">

        <h:panelGrid id="adddetailgrid" columns="2" style="width: 100%;" cellspacing="10">
            <p:outputLabel value="#{msgs.new_chemical_entity}" for="nceChkbox" styleClass="label"/>
            <p:selectBooleanCheckbox value="#{regHomeMbean.product.newChemicalEntity}" id="nceChkbox">
                <p:ajax update=":reghome:adddetailgrid" listener="#{regHomeMbean.nceChangeListener}"
                        process="@form"/>
            </p:selectBooleanCheckbox>
            <p:outputLabel value="#{msgs.new_chemical_name}" styleClass="label"
                           rendered="#{regHomeMbean.product.newChemicalEntity}"/>
            <p:inputText id="nceInput" value="#{regHomeMbean.product.newChemicalName}" style="width: 300px;"
                         rendered="#{regHomeMbean.product.newChemicalEntity}"/>
            <h:outputLabel value="#{msgs.inn_header}" style="width: 60px;" styleClass="label"/>


            <p:dataTable id="inntable" var="prodInn" value="#{regHomeMbean.selectedInns}" style="width:100%;"
                         emptyMessage="No Inns selected"
                    >
                <f:facet name="header">
                    <p:commandLink value="#{msgs.global_add}" action="#{regHomeMbean.openAddInn}"
                                   oncomplete="addInnDlg.show()" update=":addInnFrm" process="@form"/>
                </f:facet>
                <p:column headerText="Substance">
                    <h:outputText value="#{prodInn.inn.name}"/>
                </p:column>

                <p:column headerText="Quantity">
                    <h:outputText value="#{prodInn.quantity}"/>
                </p:column>

                <p:column headerText="Unit">
                    <h:outputText value="#{prodInn.uom}"/>
                </p:column>

                <p:column headerText="#{msgs.inn_ref}">
                    <h:outputText value="#{prodInn.refStd}"/>
                </p:column>

                <p:column>
                    <p:commandButton action="#{regHomeMbean.removeInn(prodInn)}" value="#{msgs.global_delete}"
                                     update=":reghome:atctable :reghome:inntable" ajax="false" immediate="true">
                        <f:setPropertyActionListener value="#{prodInn}" target="#{regHomeMbean.deleteInn}"/>
                    </p:commandButton>
                </p:column>

            </p:dataTable>

            <h:outputLabel value="#{msgs.atc_header}" style="width: 60px;" styleClass="label"/>


            <h:panelGrid columns="3" cellspacing="10">
                <h:outputLabel value="#{msgs.atc_noatc}: " for="noatc"/>
                <p:selectBooleanCheckbox id="noatc"
                                         value="#{regHomeMbean.product.noAtc}"> </p:selectBooleanCheckbox>
                <p:commandLink value="#{msgs.atc_lookup}" oncomplete="addAtcDlg.show()"
                               action="#{regHomeMbean.openAddATC()}"/>
            </h:panelGrid>
            <h:outputLabel/>

            <p:dataTable id="atctable" var="atc" value="#{regHomeMbean.selectedAtcs}" style="width:100%;">
                <p:column headerText="#{msgs.atc_code}">
                    <h:outputText value="#{atc.atcCode}"/>
                </p:column>

                <p:column headerText="#{msgs.atc_name}">
                    <h:outputText value="#{atc.atcName}"/>
                </p:column>

                <p:column>
                    <p:commandButton action="#{regHomeMbean.removeAtc(atc)}" value="#{msgs.global_delete}"
                                     update=":reghome:atctable :reghome:inntable" ajax="false" immediate="true">
                    </p:commandButton>
                </p:column>
            </p:dataTable>
        </h:panelGrid>

        <ui:include src="prodadddetails.xhtml"/>


        <div align="right">
            <p:commandButton value="#{msgs.global_save}" action="#{regHomeMbean.saveApp}"
                             update=":reghome :reghome:growl" ajax="false"/>
            <p:commandButton value="#{msgs.global_cancel}" immediate="true" action="#{regHomeMbean.cancel}"
                             ajax="false"/>
            <p:commandButton value="#{msgs.prev}" onclick="wizard.back();"/>
            <p:commandButton value="#{msgs.next}" onclick="wizard.next();"/>
        </div>
    </p:panel>


</p:tab>

<p:tab id="manufdetail" title="#{msgs.manufacturer_detail}">
    <p:panel header="#{msgs.manufacturer_detail}">
        <h:panelGrid columns="1" cellspacing="10" id="companygrid" width="100%">

            <p:outputLabel value="#{msgs.manuf_detail_txt}" styleClass="label"/>


            <p:dataTable id="companyTable" var="company" value="#{regHomeMbean.product.companies}" style="width:100%;">
                <f:facet name="header">
                    <p:commandLink value="#{msgs.global_add}" oncomplete="addCompanyDlg.show()" update="@form"
                                   process="@form">
                        <f:setPropertyActionListener value="true" target="#{regHomeMbean.showCompany}"/>
                    </p:commandLink>
                </f:facet>
                <p:column headerText="#{msgs.applicant_name}">
                    <h:outputText value="#{company.companyName}"/>
                </p:column>

                <p:column headerText="#{msgs.applicant_country}">
                    <h:outputText value="#{company.address.country.countryName}"/>
                </p:column>

                <p:column headerText="#{msgs.applicant_type}">
                    <h:outputText value="#{msgs[company.companyType.key]}"/>
                </p:column>

                <p:column headerText="Reference">
                    <h:outputText value="#{company.reference}"/>
                </p:column>

                <p:column>
                    <p:commandButton action="#{regHomeMbean.removeCompany(company)}" value="#{msgs.global_delete}"
                                     ajax="false"
                                     update=":reghome:addCompanyDlg :reghome:companygrid :reghome:growl"
                                     process="@form">
                    </p:commandButton>
                </p:column>
            </p:dataTable>

        </h:panelGrid>

        <div align="right">
            <p:commandButton value="#{msgs.global_save}" action="#{regHomeMbean.saveApp}" ajax="false"/>
            <p:commandButton value="#{msgs.global_cancel}" immediate="true" action="#{regHomeMbean.cancel}"
                             ajax="false"/>
            <p:commandButton value="#{msgs.prev}" onclick="wizard.back();"/>
            <p:commandButton value="#{msgs.next}" onclick="wizard.next();"/>
        </div>
    </p:panel>

    <p:dialog header="#{msgs.company_info}" widgetVar="addCompanyDlg" id="addCompanyDlg" resizable="true" modal="true"
              rendered="#{regHomeMbean.showCompany}">
        <p:messages showSummary="true"/>
        <ui:decorate template="/templates/companydetailtmpl.xhtml">
            <ui:param name="companydata" value="#{companyMBean.selectedCompany}"/>
            <ui:param name="input" value="#{true}"/>
        </ui:decorate>

        <h:outputLabel/>

        <h:panelGroup>
            <p:commandButton action="#{companyMBean.addCompany}" value="#{msgs.global_add}" ajax="false"
                             oncomplete="addCompanyDlg.hide()"
                             update=":reghome:addCompanyDlg :reghome:manufdetail :reghome:companygrid" process="@form"/>
            <p:commandButton action="#{companyMBean.cancelAdd}" immediate="true" value="#{msgs.global_cancel}"
                             oncomplete="addCompanyDlg.hide()" ajax="false"
                             update=":reghome:addCompanyDlg :reghome:companyTable"/>
        </h:panelGroup>
        <h:outputLabel/>
    </p:dialog>


</p:tab>

<p:tab id="pricing" title="#{msgs.product_pricing}" rendered="#{userSession.bangladesh}">
    <p:panel header="#{msgs.product_pricing_general}">

        <h:panelGrid columns="3" cellpadding="10px" cellspacing="10px" columnClasses="col1, col2, col3">
            <h:outputLabel value="#{msgs.product_pricing_max}" for="msrp"/>
            <p:inputText id="msrp" value="#{regHomeMbean.prodApplications.pricing.msrp}"
                         title="#{msgs.product_pricing_max}"
                         required="true" requiredMessage="#{msgs.valid_value_req}">
            </p:inputText>
            <p:message for="msrp" showSummary="true" showDetail="false"/>

            <h:outputLabel value="#{msgs.product_pricing_perdose}" for="priceperdose"/>
            <p:inputText id="priceperdose" value="#{regHomeMbean.prodApplications.pricing.pricePerDose}"
                         title="#{msgs.product_pricing_perdose}"
                         required="true" requiredMessage="#{msgs.valid_value_req}">
            </p:inputText>
            <p:message for="priceperdose" showSummary="true" showDetail="false"/>

            <h:outputLabel value="#{msgs.product_pricing_perday}" for="priceperday"/>
            <p:inputText id="priceperday" value="#{regHomeMbean.prodApplications.pricing.pricePerDay}"
                         title="#{msgs.product_pricing_perdose}"
                         required="true" requiredMessage="#{msgs.valid_value_req}">
            </p:inputText>
            <p:message for="priceperday" showSummary="true" showDetail="false"/>

            <h:outputLabel value="#{msgs.product_pricing_treatcost}" for="treatcost"/>
            <p:inputText id="treatcost" value="#{regHomeMbean.prodApplications.pricing.treatCost}"
                         title="#{msgs.product_pricing_perdose}"
                         required="true" requiredMessage="#{msgs.valid_value_req}">
            </p:inputText>
            <p:message for="treatcost" showSummary="true" showDetail="false"/>

        </h:panelGrid>
    </p:panel>

    <p:panel header="#{msgs.product_price_comparison}">
        <p:dataTable id="pricetable" var="price" value="#{regHomeMbean.drugPrices}" style="width:100%;">
            <f:facet name="header">
                <p:commandLink value="#{msgs.global_add}" oncomplete="addPricingDlg.show()" update="@form">
                    <f:setPropertyActionListener value="true" target="#{regHomeMbean.showDrugPrice}"/>
                </p:commandLink>
            </f:facet>
            <p:column headerText="#{msgs.drug_price_name}">
                <h:outputText value="#{price.drugName}"/>
            </p:column>

            <p:column headerText="#{msgs.drug_price_msrp}">
                <h:outputText value="#{price.msrp}"/>
            </p:column>

        </p:dataTable>

        <div align="right">
            <p:commandButton value="#{msgs.global_save}" action="#{regHomeMbean.saveApp}"/>
            <p:commandButton value="#{msgs.global_cancel}" immediate="true" action="#{regHomeMbean.cancel}"
                             ajax="false"/>
            <p:commandButton value="#{msgs.prev}" onclick="wizard.back();"/>
            <p:commandButton value="#{msgs.next}" onclick="wizard.next();"/>
        </div>
    </p:panel>

    <p:dialog header="#{msgs.product_pricing_comparison}" widgetVar="addPricingDlg" id="addPricingDlg" resizable="true"
              modal="true" rendered="#{regHomeMbean.showCompany}">
        <h:form id="pricingdlg">
            <h:outputLabel value="#{msgs.drug_price_name}" for="dpname"/>
            <p:inputText id="dpname" value="#{drugPriceMBean.selectedDrugPrice.drugName}"
                         title="#{msgs.product_pricing_perdose}"
                         required="true" requiredMessage="#{msgs.valid_value_req}">
            </p:inputText>
            <p:message for="dpname" showSummary="true" showDetail="false"/>

            <h:outputLabel value="#{msgs.drug_price_msrp}" for="dpmsrp"/>
            <p:inputText id="dpmsrp" value="#{drugPriceMBean.selectedDrugPrice.msrp}"
                         title="#{msgs.product_pricing_max}"
                         required="true" requiredMessage="#{msgs.valid_value_req}">
            </p:inputText>
            <p:message for="dpmsrp" showSummary="true" showDetail="false"/>


            <h:panelGroup>
                <p:commandButton action="#{drugPriceMBean.addDrugPrice}" value="#{msgs.global_add}"
                                 oncomplete="addPricingDlg.hide()" ajax="false"/>
                <p:commandButton action="#{drugPriceMBean.cancelAdd}" immediate="true" value="#{msgs.global_cancel}"
                                 oncomplete="addPricingDlg.hide()" ajax="false"
                                 update=":reghome:addPricingDlg :reghome:pricingTable"/>
            </h:panelGroup>
            <h:outputLabel/>
        </h:form>
    </p:dialog>

</p:tab>

<p:tab id="payment" title="#{msgs.payment_info}">
    <p:panel header="#{msgs.payment_info}">
        <h:outputLabel value="#{msgs.confirm_payment}" styleClass="label"/>

        <h:panelGrid columns="2" cellspacing="10" columnClasses="label, value" styleClass="grid">

            <h:outputLabel value="#{msgs.reciept_no}" for="receiptno"/>
            <p:inputText id="receiptno" value="#{regHomeMbean.prodApplications.receiptNo}"/>

            <h:outputLabel value="#{msgs.waybillno}" for="waybillno"/>
            <p:inputText id="waybillno" value="#{regHomeMbean.prodApplications.waybillNo}"/>
        </h:panelGrid>

        <div align="right">
            <p:commandButton value="#{msgs.global_save}" action="#{regHomeMbean.saveApp}" ajax="false"/>
            <p:commandButton value="#{msgs.global_cancel}" immediate="true" action="#{regHomeMbean.cancel}"
                             ajax="false"/>
            <p:commandButton value="#{msgs.prev}" onclick="wizard.back();"/>
            <p:commandButton value="#{msgs.next}" onclick="wizard.next();"/>
        </div>

    </p:panel>
</p:tab>

<p:tab id="prodAppChecklist" title="#{msgs.checklist}">
    <p:panel header="#{msgs.checklist}">
        <ui:include src="prodappchecklist.xhtml"/>


        <div align="right">
            <p:commandButton value="#{msgs.global_save}" action="#{regHomeMbean.saveApp}" ajax="false"/>
            <p:commandButton value="#{msgs.global_cancel}" immediate="true" action="#{regHomeMbean.cancel}"
                             ajax="false"/>
            <p:commandButton value="#{msgs.prev}" onclick="wizard.back();"/>
            <p:commandButton value="#{msgs.next}" onclick="wizard.next();"/>
        </div>

    </p:panel>
</p:tab>

<p:tab id="appointment" title="#{msgs.appointment}" rendered="false">
    <p:panel header="#{msgs.selappointment}">
        <div align="right">
            <p:commandButton value="#{msgs.global_save}" action="#{regHomeMbean.saveApp}" ajax="false"/>
            <p:commandButton value="#{msgs.global_cancel}" immediate="true" action="#{regHomeMbean.cancel}"
                             ajax="false"/>
            <p:commandButton value="#{msgs.prev}" onclick="wizard.back();"/>
            <p:commandButton value="#{msgs.next}" onclick="wizard.next();"/>
        </div>
        <p:schedule value="#{regHomeMbean.eventModel}" widgetVar="myschedule">

            <p:ajax event="dateSelect" listener="#{regHomeMbean.onDateSelect}" update=":event:eventDetails"
                    oncomplete="eventDialog.show()"/>
            <p:ajax event="eventSelect" listener="#{regHomeMbean.onEventSelect}" update=":event:eventDetails"
                    oncomplete="eventDialog.show()"/>
            <p:ajax event="eventMove" listener="#{regHomeMbean.onEventMove}" update=":reghome:growl"/>
            <p:ajax event="eventResize" listener="#{regHomeMbean.onEventResize}" update=":reghome:growl"/>

        </p:schedule>

    </p:panel>
</p:tab>


<p:tab id="summary" title="Summary">
    <p:panel header="Summary">
        <ui:decorate template="/templates/prodappsummarytmpl.xhtml">
            <ui:param name="prodData" value="#{regHomeMbean.product}"/>
        </ui:decorate>

        <div align="right">
            <p:commandButton value="#{msgs.global_save}" ajax="false" action="#{regHomeMbean.saveApp}"/>
            <p:commandButton value="#{msgs.global_cancel}" immediate="true" action="#{regHomeMbean.cancel}"
                             ajax="false"/>
            <p:commandButton value="#{msgs.prev}" onclick="wizard.back();"/>
            <p:commandButton value="#{msgs.global_submit}" action="#{regHomeMbean.submitApp}" ajax="false"/>
        </div>

    </p:panel>
</p:tab>


</p:wizard>

</h:form>

<p:dialog header="Add Active Substances" widgetVar="addInnDlg" resizable="true" modal="true">
    <h:form id="addInnFrm">
        <p:messages/>
        <pe:ajaxErrorHandler/>
        <h:panelGrid columns="2" cellspacing="5" columnClasses="label, value" styleClass="grid">
            <p:outputLabel value="#{msgs.product_innname}" for="innname"/>
            <p:autoComplete id="innname" value="#{regHomeMbean.prodInn.inn}"
                            completeMethod="#{regHomeMbean.completeInnCodes}"
                            var="it" itemLabel="#{it.name}" itemValue="#{it}" converter="#{innConverter}"
                            forceSelection="true" required="true" requiredMessage="Inn field cannot be empty">
            </p:autoComplete>

            <h:outputLabel value="#{msgs.inn_qty}" for="innqty"/>
            <p:inputText id="innqty" value="#{regHomeMbean.prodInn.quantity}"/>

            <h:outputLabel value="#{msgs.inn_unit}" for="innunit"/>
            <p:inputText id="innunit" value="#{regHomeMbean.prodInn.uom}"/>

            <h:outputLabel value="#{msgs.inn_ref}" for="innref"/>
            <p:inputText id="innref" value="#{regHomeMbean.prodInn.refStd}"/>

            <h:outputLabel/>

            <h:panelGroup>
                <p:commandButton action="#{regHomeMbean.addProdInn}" value="#{msgs.global_add}" ajax="false"
                                 update=":reghome:atctable :reghome:inntable :addInnFrm"
                                 oncomplete="!if(args.validationFailed) addInnDlg.hide()"
                                 process=":reghome:inntable :addInnFrm"/>
                <p:commandButton action="#{regHomeMbean.cancelAddInn}" immediate="true" value="#{msgs.global_cancel}"
                                 ajax="false"
                                 oncomplete="addInnDlg.hide()" update=":addInnFrm"/>
            </h:panelGroup>
            <h:outputLabel/>

        </h:panelGrid>
    </h:form>
</p:dialog>

<p:dialog header="ATC Lookup" widgetVar="addAtcDlg" resizable="true" modal="true">
    <h:form id="atcdetail">
        <h:panelGrid columns="2" cellspacing="5" columnClasses="label, value" styleClass="grid" id="atclookupgrid">
            <h:outputLabel value="#{msgs.atc_name}" for="atcname"/>
            <p:autoComplete id="atcname" value="#{regHomeMbean.atc}"
                            completeMethod="#{regHomeMbean.completeAtcNames}"
                            var="it" itemLabel="#{it.atcName}" itemValue="#{it}" converter="#{atcConverter}"
                            forceSelection="true">
                <p:ajax event="itemSelect" listener="#{regHomeMbean.updateAtc}" update=":atcdetail"/>
            </p:autoComplete>

            <h:outputLabel value="#{msgs.atc_code}" for="atccode"/>
            <p:outputLabel value="#{regHomeMbean.atc.atcCode}" id="atccode"/>
        </h:panelGrid>


        <p:tree value="#{regHomeMbean.selAtcTree}" var="node" id="treeMultiple" selectionMode="single">
            <p:treeNode>
                <h:outputText value="#{node}"/>
            </p:treeNode>
        </p:tree>


        <h:outputLabel/>

        <h:panelGroup>
            <p:commandButton action="#{regHomeMbean.addAtc}" value="#{msgs.global_add}"
                             update=":reghome:atctable :atcdetail :atcdetail:treeMultiple"
                             oncomplete="addAtcDlg.hide()" ajax="false"/>
            <p:commandButton action="#{regHomeMbean.cancelAddInn}" value="#{msgs.global_cancel}"
                             oncomplete="addAtcDlg.hide()"/>
        </h:panelGroup>
        <h:outputLabel/>

    </h:form>
</p:dialog>


<p:dialog widgetVar="eventDialog" header="Event Details" showEffect="clip" hideEffect="clip">
    <h:form id="event">
        <h:panelGrid id="eventDetails" columns="2">

            <h:outputLabel for="from" value="From:"/>
            <p:inputMask id="from" value="#{regHomeMbean.event.startDate}" mask="99/99/9999">
                <f:convertDateTime pattern="dd/MM/yyyy"/>
            </p:inputMask>

            <h:outputLabel for="to" value="To:"/>
            <p:inputMask id="to" value="#{regHomeMbean.event.endDate}" mask="99/99/9999">
                <f:convertDateTime pattern="dd/MM/yyyy"/>
            </p:inputMask>

            <h:outputLabel for="allDay" value="All Day:"/>
            <h:selectBooleanCheckbox id="allDay" value="#{regHomeMbean.event.allDay}"/>

            <p:commandButton type="reset" value="Reset"/>
            <p:commandButton value="Save" actionListener="#{regHomeMbean.addEvent}"
                             oncomplete="reghome:myschedule.update(); event:eventDialog.hide();"/>
        </h:panelGrid>
    </h:form>
</p:dialog>

</ui:define>
</ui:composition>
