<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                template="../templates/admin_layout.xhtml">
<ui:define name="content">
<div class="post">
    <h1 class="title ui-widget-header ui-corner-all"> #{msgs.product_reg}</h1>
</div>

<h:form id="reghome">
<p:growl id="growl"/>

<p:wizard widgetVar="wizard" showNavBar="false">
<p:tab id="prodreg" title="#{msgs.applicant_detail}">

    <ui:include src="appinfosub.xhtml"/>

</p:tab>

<p:tab id="proddetails" title="#{msgs.product_details}">
    <p:panel header="#{msgs.product_details}">

        <h:panelGrid columns="3" cellpadding="10px" cellspacing="10px" columnClasses="col1, col2, col3">
            <h:outputLabel value="#{msgs.prod_type}" for="prodTypecb"/>
            <p:selectOneMenu id="prodTypecb" value="#{regHomeMbean.prodApplications.prod.prodType}" required="true"
                             requiredMessage="#{msgs.valid_prod_type}">
                <f:selectItem itemLabel="-" itemValue=""/>
                <f:selectItems value="#{globalLists.prodTypes}" var="prodtype" itemLabel="#{msgs[prodtype.key]}"/>
            </p:selectOneMenu>
            <p:message for="prodTypecb" showSummary="true" showDetail="false"/>

            <h:outputLabel value="#{msgs.prodName}" for="prodDetailName"/>
            <p:inputText id="prodDetailName" value="#{regHomeMbean.prodApplications.prod.prodName}" title="Product Name"
                         required="true" requiredMessage="#{msgs.valid_prod_name}" style="width: 300px;">
            </p:inputText>
            <p:message for="prodDetailName" showSummary="true" showDetail="false"/>

            <h:outputLabel value="#{msgs.prodgenname}" for="prodGenName"/>
            <p:inputText id="prodGenName" value="#{regHomeMbean.prodApplications.prod.genName}" title="Generic Name"
                         required="true" requiredMessage="#{msgs.valid_gen_name}"/>
            <p:message for="prodGenName" showSummary="true" showDetail="false"/>

            <h:outputLabel value="#{msgs.dos_form}" for="dosForm"/>
            <p:selectOneMenu id="dosForm" value="#{regHomeMbean.prodApplications.prod.dosForm.uid}"
                             requiredMessage="#{msgs.valid_dos_form}" required="true">
                <f:selectItem itemLabel="-" itemValue=""/>
                <f:selectItems value="#{globalEntityLists.dosageForms}" var="dosForm" itemLabel="#{dosForm.dosForm}"
                               itemValue="#{dosForm.uid}"/>
            </p:selectOneMenu>
            <p:message for="dosForm" showSummary="true" showDetail="false"/>


            <h:outputLabel value="#{msgs.dos_unit}" for="dosUnit"/>
            <p:selectOneMenu id="dosUnit" value="#{regHomeMbean.prodApplications.prod.dosUnit.id}"
                             requiredMessage="#{msgs.valid_dos_form}" required="true">
                <f:selectItem itemLabel="-" itemValue=""/>
                <f:selectItems value="#{globalEntityLists.dosUoms}" var="dosUom" itemLabel="#{dosUom.uom}"
                               itemValue="#{dosUom.id}"/>
            </p:selectOneMenu>
            <p:message for="dosUnit" showSummary="true" showDetail="false"/>

            <h:outputLabel value="#{msgs.dos_strength}" for="dosStrength"/>
            <p:inputText id="dosStrength" value="#{regHomeMbean.prodApplications.prod.dosStrength}" title="DosStrength"
                         required="true" requiredMessage="#{msgs.dos_strength}: Value required">
            </p:inputText>
            <p:message for="dosStrength" severity="error" showSummary="true" showDetail="false"/>

            <h:outputLabel value="#{msgs.admin_route}" for="adminroutecb"/>
            <p:selectOneMenu id="adminroutecb" value="#{regHomeMbean.prodApplications.prod.adminRoute}" required="true"
                             requiredMessage="#{msgs.valid_value_req}">
                <f:selectItem itemLabel="-" itemValue=""/>
                <f:selectItems value="#{globalLists.adminRoutes}" var="type" itemLabel="#{msgs[type.key]}"/>
            </p:selectOneMenu>
            <p:message for="adminroutecb" showSummary="true" showDetail="false"/>

            <h:outputLabel value="#{msgs.product_pharmclassif}" for="pharmClassifcb"/>
            <p:selectOneMenu id="pharmClassifcb" value="#{regHomeMbean.prodApplications.prod.pharmClassif.id}"
                             required="true" requiredMessage="#{msgs.valid_value_req}">
                <f:selectItem itemLabel="-" itemValue=""/>
                <f:selectItems value="#{regHomeMbean.pharmClassifList}" var="classif" itemLabel="#{classif.displayName}"
                               itemValue="#{classif.id}"></f:selectItems>
            </p:selectOneMenu>
            <p:message for="pharmClassifcb" showSummary="true" showDetail="false"/>

            <h:outputLabel value="#{msgs.global_description}" for="prodDesc"/>
            <p:inputTextarea id="prodDesc" value="#{regHomeMbean.prodApplications.prod.prodDesc}" rows="4" cols="50"
                             title="ProdDesc"/>
        </h:panelGrid>


        <div align="right">
            <p:commandButton value="#{msgs.global_save}" action="#{regHomeMbean.save}"/>
            <p:commandButton value="#{msgs.global_cancel}" immediate="true" action="#{regHomeMbean.cancel}"
                             ajax="false"/>
            <p:commandButton value="#{msgs.prev}" onclick="wizard.back();"/>
            <p:commandButton value="#{msgs.next}" onclick="wizard.next();"/>
        </div>
    </p:panel>
</p:tab>


<p:tab id="appdetails" title="#{msgs.application_detail}">
    <p:panel header="#{msgs.application_detail}">
        <h:panelGrid columns="2" style="width: 100%;">
            <h:outputLabel value="#{msgs.inn_header}" style="width: 60px;" styleClass="label"/>
            <p:dataTable id="inntable" var="prodInn" value="#{regHomeMbean.selectedInns}" style="width:100%;"
                         emptyMessage="No Inns selected"
                    >
                <f:facet name="header">
                    <p:commandLink value="#{msgs.global_add}" immediate="true" action="#{regHomeMbean.openAddInn}"
                                   oncomplete="addInnDlg.show()"/>
                </f:facet>
                <p:column headerText="Substance">
                    <h:outputText value="#{prodInn.inn.name}"/>
                </p:column>

                <p:column headerText="Quantity">
                    <h:outputText value="#{prodInn.quantity}"/>
                </p:column>

                <p:column headerText="Unit">
                    <h:outputText value="#{prodInn.uom}"/>
                </p:column>

                <p:column headerText="Reference">
                    <h:outputText value="#{prodInn.refStd}"/>
                </p:column>

                <p:column>
                    <p:commandButton action="#{regHomeMbean.removeInn(prodInn)}" value="#{msgs.global_delete}"
                                     update=":reghome:atctable :reghome:inntable" ajax="false" immediate="true">
                        <f:setPropertyActionListener value="#{prodInn}" target="#{regHomeMbean.deleteInn}"/>
                    </p:commandButton>
                </p:column>

            </p:dataTable>

            <h:outputLabel value="#{msgs.atc_header}" style="width: 60px;" styleClass="label"/>
            <h:panelGroup>
                <h:outputLabel value="#{msgs.atc_noatc}" for="noatc"/>
                <p:selectBooleanCheckbox id="noatc"
                                         value="#{regHomeMbean.prodApplications.prod.noAtc}"> </p:selectBooleanCheckbox>
                <p:commandLink value="#{msgs.atc_lookup}" immediate="true" oncomplete="addAtcDlg.show()"/>
            </h:panelGroup>
            <h:outputLabel/>

            <p:dataTable id="atctable" var="atc" value="#{regHomeMbean.selectedAtcs}" style="width:100%;">
                <p:column headerText="#{msgs.atc_code}">
                    <h:outputText value="#{atc.atcCode}"/>
                </p:column>

                <p:column headerText="#{msgs.atc_name}">
                    <h:outputText value="#{atc.atcName}"/>
                </p:column>
            </p:dataTable>
        </h:panelGrid>

        <h:panelGrid columns="3" cellspacing="10px" cellpadding="10px" columnClasses="label, value" styleClass="grid">
            <h:outputLabel value="#{msgs.product_drug_type}" for="cbdrugtype"/>
            <p:selectOneMenu id="cbdrugtype" value="#{regHomeMbean.prodApplications.drugType}">
                <f:selectItem itemLabel="-" itemValue=""/>
                <f:selectItems value="#{globalLists.drugTypes}" var="dt" itemLabel="#{msgs[dt.key]}"/>
            </p:selectOneMenu>
            <p:message for="cbdrugtype" showSummary="true" showDetail="false"/>

            <h:outputLabel value="#{msgs.product_relcntrlr}" for="inrepresent"/>
            <p:inputText id="inrepresent" value="#{regHomeMbean.prodApplications.representative}" required="true"
                         style="width: 300px"/>
            <p:message for="inrepresent" showSummary="true" showDetail="false"/>

            <h:outputLabel value="#{msgs.product_packsize}" for="inpacksize"/>
            <p:inputText id="inpacksize" value="#{regHomeMbean.prodApplications.packSize}" style="width: 300px"/>
            <p:message for="inpacksize" showSummary="true" showDetail="false"/>


            <h:outputLabel value="#{msgs.product_conttype}" for="inconttype"/>
            <p:inputTextarea id="inconttype" value="#{regHomeMbean.prodApplications.contType}" style="width: 300px"/>
            <p:message for="inconttype" showSummary="true" showDetail="false"/>

            <h:outputLabel value="#{msgs.product_storcndtn}" for="instorecndtn"/>
            <p:inputText id="instorecndtn" value="#{regHomeMbean.prodApplications.storageCndtn}" style="width: 300px"/>
            <p:message for="instorecndtn" showSummary="true" showDetail="false"/>


            <h:outputLabel value="#{msgs.product_apperance}" for="inapperance"/>
            <p:inputText id="inapperance" value="#{regHomeMbean.prodApplications.phyAppearance}" style="width: 300px"/>
            <p:message for="inapperance" showSummary="true" showDetail="false"/>

            <h:outputLabel value="#{msgs.product_regNoCntry}" for="inregNoCntry"/>
            <p:inputTextarea id="inregNoCntry" value="#{regHomeMbean.prodApplications.originCntryReg}"
                             style="width: 300px"/>
            <p:message for="inregNoCntry" showSummary="true" showDetail="false"/>


            <h:outputLabel value="#{msgs.product_active}" for="inpharmstd"/>
            <p:inputTextarea id="inpharmstd" value="#{regHomeMbean.prodApplications.pharmacopeiaStds}"
                             style="width: 300px"/>
            <p:message for="inpharmstd" showSummary="true" showDetail="false"/>

            <h:outputLabel value="#{msgs.product_ssncode}" for="inssncode"/>
            <p:inputText id="inssncode" value="#{regHomeMbean.prodApplications.ssnCode}" style="width: 300px"/>
            <p:message for="inssncode" showSummary="true" showDetail="false"/>
        </h:panelGrid>


        <div align="right">
            <p:commandButton value="#{msgs.global_save}" action="#{regHomeMbean.save}" ajax="false"/>
            <p:commandButton value="#{msgs.global_cancel}" immediate="true" action="#{regHomeMbean.cancel}"
                             ajax="false"/>
            <p:commandButton value="#{msgs.prev}" onclick="wizard.back();"/>
            <p:commandButton value="#{msgs.next}" onclick="wizard.next();"/>
        </div>
    </p:panel>


</p:tab>

<p:tab id="manufdetail" title="#{msgs.manufacturer_detail}">
    <h:messages errorClass="error"/>

    <p:panel header="#{msgs.manufacturer_detail}">

        <p:dataTable id="companyTable" var="company" value="#{regHomeMbean.companies}" style="width:100%;">
            <f:facet name="header">
                <p:commandLink value="#{msgs.global_add}" immediate="true" oncomplete="addCompanyDlg.show()"/>
            </f:facet>
            <p:column headerText="#{msgs.applicant_name}">
                <h:outputText value="#{company.companyName}"/>
            </p:column>

            <p:column headerText="#{msgs.applicant_country}">
                <h:outputText value="#{company.address.country.countryName}"/>
            </p:column>

            <p:column headerText="#{msgs.applicant_type}">
                <h:outputText value="#{msgs[company.companyType.key]}"/>
            </p:column>

            <p:column headerText="Reference">
                <h:outputText value="#{company.reference}"/>
            </p:column>

            <p:column>
                <p:commandButton action="#{companyMBean.removeCompany}" value="#{msgs.global_delete}" immediate="true">
                    <f:setPropertyActionListener value="#{company}" target="#{companyMBean.selectedCompany}"/>
                </p:commandButton>
            </p:column>
        </p:dataTable>

        <div align="right">
            <p:commandButton value="#{msgs.global_save}" action="#{regHomeMbean.save}" ajax="false"/>
            <p:commandButton value="#{msgs.global_cancel}" immediate="true" action="#{regHomeMbean.cancel}"
                             ajax="false"/>
            <p:commandButton value="#{msgs.prev}" onclick="wizard.back();"/>
            <p:commandButton value="#{msgs.next}" onclick="wizard.next();"/>
        </div>
    </p:panel>


</p:tab>

<p:tab id="payment" title="#{msgs.payment_info}">
    <p:panel header="#{msgs.payment_info}">
        <h:outputLabel value="#{msgs.confirm_payment}"/>

        <h:panelGrid columns="2" cellspacing="10" columnClasses="label, value" styleClass="grid">

            <h:outputLabel value="#{msgs.reciept_no}" for="receiptno"/>
            <p:inputText id="receiptno" value="#{regHomeMbean.prodApplications.receiptNo}"/>

            <h:outputLabel value="#{msgs.waybillno}" for="waybillno"/>
            <p:inputText id="waybillno" value="#{regHomeMbean.prodApplications.waybillNo}"/>
        </h:panelGrid>

        <div align="right">
            <p:commandButton value="#{msgs.global_save}" action="#{regHomeMbean.save}" ajax="false"/>
            <p:commandButton value="#{msgs.global_cancel}" immediate="true" action="#{regHomeMbean.cancel}"
                             ajax="false"/>
            <p:commandButton value="#{msgs.prev}" onclick="wizard.back();"/>
            <p:commandButton value="#{msgs.next}" onclick="wizard.next();"/>
        </div>

    </p:panel>
</p:tab>

<p:tab id="prodAppChecklist" title="#{msgs.checklist}">
    <p:panel header="#{msgs.checklist}">
        <p:dataTable var="checkList" value="#{regHomeMbean.prodAppChecklists}" style="width:100%;">
            <p:column headerText="">
                <h:outputLabel value="#{checkList.checklist.moduleNo}"/>
            </p:column>
            <p:column>
                <h:outputLabel value="#{checkList.checklist.name}"/>
            </p:column>
            <p:column>
                <h:outputLabel value="#{checkList.checklist.module}"/>
            </p:column>
            <p:column>
                <p:selectBooleanCheckbox value="#{checkList.value}"/>
            </p:column>
        </p:dataTable>


        <div align="right">
            <p:commandButton value="#{msgs.global_save}" action="#{regHomeMbean.save}" ajax="false"/>
            <p:commandButton value="#{msgs.global_cancel}" immediate="true" action="#{regHomeMbean.cancel}"
                             ajax="false"/>
            <p:commandButton value="#{msgs.prev}" onclick="wizard.back();"/>
            <p:commandButton value="#{msgs.next}" onclick="wizard.next();"/>
        </div>

    </p:panel>
</p:tab>

<p:tab id="appointment" title="#{msgs.appointment}">
    <p:panel header="#{msgs.selappointment}">
        <div align="right">
            <p:commandButton value="#{msgs.global_save}" action="#{regHomeMbean.save}" ajax="false"/>
            <p:commandButton value="#{msgs.global_cancel}" immediate="true" action="#{regHomeMbean.cancel}"
                             ajax="false"/>
            <p:commandButton value="#{msgs.prev}" onclick="wizard.back();"/>
            <p:commandButton value="#{msgs.next}" onclick="wizard.next();"/>
        </div>
        <p:schedule value="#{regHomeMbean.eventModel}" widgetVar="myschedule">

            <p:ajax event="dateSelect" listener="#{regHomeMbean.onDateSelect}" update=":event:eventDetails"
                    oncomplete="eventDialog.show()"/>
            <p:ajax event="eventSelect" listener="#{regHomeMbean.onEventSelect}" update=":event:eventDetails"
                    oncomplete="eventDialog.show()"/>
            <p:ajax event="eventMove" listener="#{regHomeMbean.onEventMove}" update="messages"/>
            <p:ajax event="eventResize" listener="#{regHomeMbean.onEventResize}" update="messages"/>

        </p:schedule>

    </p:panel>
</p:tab>


<p:tab id="summary" title="Summary">
    <p:panel header="Summary">
        <ui:decorate template="/templates/prodappsummarytmpl.xhtml">
            <ui:param name="prodAppData" value="#{regHomeMbean.prodApplications}"/>
        </ui:decorate>

        <div align="right">
            <p:commandButton value="#{msgs.global_save}" ajax="false" action="#{regHomeMbean.save}"/>
            <p:commandButton value="#{msgs.global_cancel}" immediate="true" action="#{regHomeMbean.cancel}"
                             ajax="false"/>
            <p:commandButton value="#{msgs.prev}" onclick="wizard.back();"/>
            <p:commandButton value="#{msgs.global_submit}" action="#{regHomeMbean.submitApp}" ajax="false"/>
        </div>

    </p:panel>
</p:tab>


</p:wizard>

</h:form>

<p:dialog header="Add Active Substances" widgetVar="addInnDlg" resizable="true" modal="true">
    <h:form id="addInnFrm">
        <h:panelGrid columns="2" cellspacing="5" columnClasses="label, value" styleClass="grid">
            <h:outputLabel value="#{msgs.product_innname}" for="innname"/>
            <p:autoComplete id="innname" value="#{regHomeMbean.prodInn.inn}"
                            completeMethod="#{regHomeMbean.completeInnCodes}"
                            var="it" itemLabel="#{it.name}" itemValue="#{it}" converter="#{innConverter}"
                            forceSelection="true">
            </p:autoComplete>

            <h:outputLabel value="#{msgs.inn_qty}" for="innqty"/>
            <p:inputText id="innqty" value="#{regHomeMbean.prodInn.quantity}"/>

            <h:outputLabel value="#{msgs.inn_unit}" for="innunit"/>
            <p:inputText id="innunit" value="#{regHomeMbean.prodInn.uom}"/>

            <h:outputLabel value="#{msgs.inn_ref}" for="innref"/>
            <p:inputText id="innref" value="#{regHomeMbean.prodInn.refStd}"/>

            <h:outputLabel/>

            <h:panelGroup>
                <p:commandButton action="#{regHomeMbean.addProdInn}" value="#{msgs.global_add}"
                                 update=":reghome:atctable :reghome:inntable :addInnFrm" oncomplete="addInnDlg.hide()"/>
                <p:commandButton action="#{regHomeMbean.cancelAddInn}" immediate="true" value="#{msgs.global_cancel}"
                                 oncomplete="addInnDlg.hide()" update=":addInnFrm"/>
            </h:panelGroup>
            <h:outputLabel/>

        </h:panelGrid>
    </h:form>
</p:dialog>

<p:dialog header="ATC Lookup" widgetVar="addAtcDlg" resizable="true" modal="true">
    <h:form id="atcdetail">
        <h:panelGrid columns="2" cellspacing="5" columnClasses="label, value" styleClass="grid">
            <h:outputLabel value="#{msgs.atc_name}" for="atcname"/>
            <p:autoComplete id="atcname" value="#{regHomeMbean.atc}"
                            completeMethod="#{regHomeMbean.completeAtcNames}"
                            var="it" itemLabel="#{it.atcName}" itemValue="#{it}" converter="#{atcConverter}"
                            forceSelection="true">
                <p:ajax event="itemSelect" update="@form" listener="#{regHomeMbean.updateAtc}"/>
            </p:autoComplete>

            <h:outputLabel value="#{msgs.atc_code}" for="atccode"/>
            <p:autoComplete id="atccode" value="#{regHomeMbean.atc}"
                            completeMethod="#{regHomeMbean.completeAtcCodes}"
                            var="it" itemLabel="#{it.atcCode}" itemValue="#{it}" converter="#{atcCodeConverter}"
                            forceSelection="true">
                <p:ajax event="itemSelect" update="@form" listener="#{regHomeMbean.updateAtc}"/>
            </p:autoComplete>
        </h:panelGrid>


        <p:tree value="#{regHomeMbean.selAtcTree}" var="node" id="treeMultiple" selectionMode="single">
            <p:treeNode>
                <h:outputText value="#{node}"/>
            </p:treeNode>
        </p:tree>


        <h:outputLabel/>

        <h:panelGroup>
            <p:commandButton action="#{regHomeMbean.addAtc}" value="#{msgs.global_add}"
                             update=":reghome:atctable :atcdetail :atcdetail:treeMultiple"
                             oncomplete="addAtcDlg.hide()"/>
            <p:commandButton action="#{regHomeMbean.cancelAddInn}" value="#{msgs.global_cancel}"
                             oncomplete="addAtcDlg.hide()"/>
        </h:panelGroup>
        <h:outputLabel/>

    </h:form>
</p:dialog>

<p:dialog header="#{msgs.company_info}" widgetVar="addCompanyDlg" resizable="true" modal="true">
    <h:form prependId="false">
        <ui:decorate template="/templates/companydetailtmpl.xhtml">
            <ui:param name="companydata" value="#{companyMBean.selectedCompany}"/>
            <ui:param name="input" value="#{true}"/>
        </ui:decorate>

        <h:outputLabel/>

        <h:panelGroup>
            <p:commandButton action="#{companyMBean.addCompany}" value="#{msgs.global_add}"
                             oncomplete="addCompanyDlg.hide()" ajax="false" update=":addCompanyDlg"/>
            <p:commandButton action="#{companyMBean.cancelAdd}" immediate="true" value="#{msgs.global_cancel}"
                             oncomplete="addCompanyDlg.hide()" ajax="false" update=":addCompanyDlg"/>
        </h:panelGroup>
        <h:outputLabel/>
    </h:form>
</p:dialog>


<p:dialog widgetVar="eventDialog" header="Event Details" showEffect="clip" hideEffect="clip">
    <h:form id="event">
        <h:panelGrid id="eventDetails" columns="2">

            <h:outputLabel for="from" value="From:"/>
            <p:inputMask id="from" value="#{regHomeMbean.event.startDate}" mask="99/99/9999">
                <f:convertDateTime pattern="dd/MM/yyyy"/>
            </p:inputMask>

            <h:outputLabel for="to" value="To:"/>
            <p:inputMask id="to" value="#{regHomeMbean.event.endDate}" mask="99/99/9999">
                <f:convertDateTime pattern="dd/MM/yyyy"/>
            </p:inputMask>

            <h:outputLabel for="allDay" value="All Day:"/>
            <h:selectBooleanCheckbox id="allDay" value="#{regHomeMbean.event.allDay}"/>

            <p:commandButton type="reset" value="Reset"/>
            <p:commandButton value="Save" actionListener="#{regHomeMbean.addEvent}"
                             oncomplete="reghome:myschedule.update(); event:eventDialog.hide();"/>
        </h:panelGrid>
    </h:form>
</p:dialog>

</ui:define>
</ui:composition>
