<!--
  ~ Copyright (c) 2014. Management Sciences for Health. All Rights Reserved.
  -->

<!-- Creates the table with passed in values of product -->
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://java.sun.com/jsf/core"
                template="../templates/process_reg_layout.xhtml">
    <ui:define name="content">

        <h:form id="reviewHome" enctype="multipart/form-data">
            <p:growl id="growl" showSummary="true"/>
            <p:messages showDetail="true" showSummary="true"/>

            <div style="width:1054px">
                <ui:decorate template="/templates/prodbannertempl.xhtml">
                    <ui:param name="prodApp" value="#{reviewInfoBn.prodApplications}"/>
                </ui:decorate>
            </div>

            <div style="height: 10px;"/>

            <div align="right">
                <p:commandButton value="#{msgs.approve_review}" action="#{reviewInfoBn.approveReview}"
                                 update=":reviewHome"
                                 ajax="false"
                                 rendered="#{userSession.moderator and reviewInfoBn.reviewInfo.submitted}"/>
                <p:commandButton value="#{msgs.send_to_review}" action="#{reviewInfoBn.reviewerFeedback}"
                                 update=":reviewHome"
                                 ajax="false"
                                 rendered="#{userSession.moderator and reviewInfoBn.reviewInfo.submitted}"/>
                <p:commandButton value="#{msgs.global_save}" action="#{reviewInfoBn.saveReview}" ajax="true"
                                 update=":reviewHome" process="@this"
                                 rendered="#{userSession.reviewer and !reviewInfoBn.reviewInfo.submitted}"/>
                <p:commandButton value="#{msgs.global_submit}" action="#{reviewInfoBn.submitReview}"
                                 update=":reviewHome"
                                 ajax="false"
                                 rendered="#{userSession.reviewer and !reviewInfoBn.reviewInfo.submitted}"/>
                <p:commandButton value="#{msgs.global_back}" immediate="true" action="#{reviewInfoBn.cancelReview}"
                                 ajax="false"/>
            </div>

            <div style="height: 10px;"/>

            <p:accordionPanel >
                <p:tab title="Overall Summary">
                    <h:panelGrid columns="2" cellpadding="10" cellspacing="10" id="reviewgrid">
                        <p:outputLabel value="#{msgs.recommendation}" for="recomcb"/>

                        <p:selectOneMenu id="recomcb" value="#{reviewInfoBn.reviewInfo.recomendType}"
                                         requiredMessage="#{msgs.recommendation_valid}" >
                            <f:selectItem itemLabel="-"/>
                            <f:selectItems value="#{globalLists.recomendType}" var="type" itemLabel="#{msgs[type.key]}"/>
                        </p:selectOneMenu>

                        <p:outputLabel value="Summary" />
                        <p:editor value="#{reviewInfoBn.reviewInfo.execSummary}" rendered="#{!reviewInfoBn.readOnly}"/>
                        <h:outputText value="#{reviewInfoBn.reviewInfo.execSummary}" escape="false" rendered="#{reviewInfoBn.readOnly}"/>

                        <p:outputLabel value="#{msgs.mod_comment}" for="modcomment"/>
                        <p:editor value="#{reviewInfoBn.reviewInfo.modcomment}" id="modcomment"
                                  width="700" rendered="#{userSession.moderator}"/>
                        <h:outputText value="#{reviewInfoBn.reviewInfo.modcomment}" escape="false"
                                      rendered="#{userSession.reviewer||userSession.head}"/>

                    </h:panelGrid>

                </p:tab>
            </p:accordionPanel>
            <p:accordionPanel value="#{reviewInfoBn.displayReviewQs}" var="header1" id="displayReviewQsacp">
                <p:tab title="#{header1.header1}">
                    <p:tabView orientation="left" value="#{header1.header2s}" var="header2">
                        <p:tab title="#{header2.header2}">
                            <p:dataTable value="#{header2.displayReviewInfos}" var="quest" styleClass="borderless" >
                                <p:column headerText="#{msgs.complete_review}">

                                    <p:commandButton value="#{quest.save?msgs.global_update:msgs.global_add}"
                                                     action="#{reviewInfoBn.updateReview(quest)}"
                                                     ajax="false" rendered="#{!reviewInfoBn.readOnly}">
                                    </p:commandButton>
                                    <p:commandButton value="#{msgs.view_response}"
                                                     action="#{reviewInfoBn.updateReview(quest)}"
                                                     ajax="false" rendered="#{reviewInfoBn.readOnly}">
                                    </p:commandButton>
                                    <p:commandButton value="#{msgs.global_na}"
                                                     action="#{reviewInfoBn.reviewNA(quest)}"
                                                     ajax="true" update=":reviewHome:displayReviewQsacp" rendered="#{!reviewInfoBn.readOnly}">
                                    </p:commandButton>


                                    <h:panelGroup layout="block" styleClass="#{quest.save?'review_question_inactive':'review_question_active'}">
                                        <h:outputText value="#{quest.question}" escape="false"/>
                                    </h:panelGroup>
                                </p:column>
                            </p:dataTable>
                        </p:tab>
                    </p:tabView>
                    <div style="height: 10px;"/>
                </p:tab>
            </p:accordionPanel>


        </h:form>

        <div style="height: 10px;"/>

    </ui:define>
</ui:composition>
