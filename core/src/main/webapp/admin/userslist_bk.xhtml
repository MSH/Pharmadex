<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                template="../templates/layout.xhtml">
    <ui:define name="content">
        <h:form id="userlist">
            <h:panelGroup id="content">

                <div class="post">
                    <h1 class="title ui-widget-header ui-corner-all"> #{msgs.Userlist}</h1>
                </div>

                <p:growl id="growl" showDetail="true"/>
                <p:messages id="messages" showDetail="true" showSummary="true"/>
                <p:dataTable id="users" var="user" value="#{userMBean.allUsers}">
                    <f:facet name="header">
                        <p:commandButton value="#{msgs.global_add}" action="#{userMBean.addUser}"
                                         oncomplete="adduser.show();"
                                         update=":adduserfrm"/>
                    </f:facet>

                    <p:column headerText="#{msgs.User_name}">
                        <p:commandLink value=" #{user.name}" oncomplete="adduser.show();" update=":adduserfrm"
                                       ajax="true">
                            <f:setPropertyActionListener value="#{user}" target="#{userMBean.selectedUser}"/>
                            <f:setPropertyActionListener value="#{true}" target="#{userMBean.edit}"/>
                        </p:commandLink>
                    </p:column>

                    <p:column headerText="#{msgs.User_username}">
                        #{user.username}
                    </p:column>

                    <p:column headerText="#{msgs.User_email}">
                        #{user.email}
                    </p:column>

                    <p:column headerText="#{msgs.User_applicant}">
                        #{user.companyName}
                    </p:column>
                </p:dataTable>
            </h:panelGroup>
        </h:form>

        <p:dialog widgetVar="adduser" modal="true" resizable="false" header="Add User">
            <h:form id="adduserfrm">
                <p:messages showDetail="true" showSummary="true"/>

                <ui:decorate template="/templates/userdetailtmpl.xhtml">
                    <ui:param name="userdata" value="#{userMBean.selectedUser}"/>
                    <ui:param name="input" value="true"/>
                </ui:decorate>

                <h:inputHidden value="#{userMBean.selectedUser.userId}"/>
                <h:inputHidden value="#{userMBean.selectedUser.password}"/>

                <h:panelGrid columns="4" columnClasses="col1, col2, col1, col2" cellpadding="5" cellspacing="5">
                    <h:outputLabel value="#{msgs.User_username}"/>
                    <p:inputText value="#{userMBean.selectedUser.username}" readonly="#{userMBean.edit}"/>

                    <h:outputText value="#{msgs.user_type}"/>
                    <p:selectOneMenu value="#{userMBean.selectedUser.type}">
                        <f:selectItem itemLabel="-" itemValue=""/>
                        <f:selectItems value="#{globalLists.userTypes}" var="type" itemLabel="#{msgs[type.key]}"/>
                    </p:selectOneMenu>

                    <h:outputLabel value="#{msgs.user_assigncompany}"/>
                    <p:selectOneMenu value="#{userMBean.userApp.applcntId}">
                        <f:selectItem itemLabel="-" itemValue=""/>
                        <f:selectItems value="#{applicantService.findAllApplicants()}" var="applicant"
                                       itemLabel="#{applicant.appName}" itemValue="#{applicant.applcntId}"/>
                    </p:selectOneMenu>


                    <h:outputText value="#{msgs.global_enable}"/>
                    <p:selectBooleanButton value="#{userMBean.selectedUser.enabled}" onLabel="#{msgs.global_yes}"
                                           offLabel="#{msgs.global_no}" onIcon="ui-icon-check" offIcon="ui-icon-close">
                    </p:selectBooleanButton>

                    <p:commandButton action="#{userMBean.resetPassword}" value="#{msgs.reset_password}"
                                     oncomplete="adduser.hide()"
                                     update=":userlist:users :userlist:messages :adduserfrm"
                                     rendered="#{userMBean.edit}"/>
                </h:panelGrid>

                <p:panel header="#{msgs.role}">
                    <p:pickList id="rolepicklist" value="#{userMBean.roles}" effect="bounce"
                                var="rolevar" style="align:center;" converter="#{roleConverter}"
                                itemValue="#{rolevar}" itemLabel="#{rolevar.rolename}">
                    </p:pickList>

                </p:panel>


                <p:commandButton action="#{userMBean.saveUser}" value="#{msgs.global_add}" oncomplete="if (!args.validationFailed) adduser.hide()"
                                 update=":userlist:users :userlist:messages :adduserfrm" rendered="#{!userMBean.edit}"/>
                <p:commandButton action="#{userMBean.updateuser}" value="#{msgs.global_update}"
                                 oncomplete="if (!args.validationFailed) adduser.hide()"
                                 update=":userlist:users :userlist:messages :adduserfrm" rendered="#{userMBean.edit}"/>
                <p:commandButton action="#{userMBean.cancelUser}" immediate="true" value="#{msgs.global_cancel}"
                                 oncomplete="adduser.hide()" ajax="false"/>
            </h:form>
        </p:dialog>

    </ui:define>
</ui:composition>
