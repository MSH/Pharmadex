<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://java.sun.com/jsf/core"
                template="../templates/process_reg_layout.xhtml">
    <ui:define name="content">

        <h:form id="reghome">

            <h:panelGrid columns="2" columnClasses="menu,content" cellpadding="10px">
                <p:menu style="width:198px">
                    <p:submenu label="#{msgs.Registration}">
                        <p:menuitem value="#{msgs.global_save}" icon="ui-icon-gear"
                                    action="#{processPIPOrderBn.saveApp}" ajax="false"
                                    rendered="#{!userSession.company}"/>
                        <p:menuitem value="#{msgs.complete_review}" icon="ui-icon-document" action="#{processPIPOrderBn.initComment}"
                                    oncomplete="PF('reviewDlg').show()" id="review" rendered="#{processPIPOrderBn.displayReview}"/>
                        <p:menuitem value="#{msgs.add_comment}" icon="ui-icon-document" action="#{processPIPOrderBn.initComment}"
                                    oncomplete="PF('reviewDlg').show()" id="reviewcomment" rendered="#{processPIPOrderBn.displayReviewComment}"/>
                        <p:menuitem value="#{msgs.global_cancel}" immediate="true"
                                    icon="ui-icon ui-icon-circle-triangle-w"
                                    action="#{processPIPOrderBn.cancel}" ajax="false"/>
                    </p:submenu>
                    <p:submenu label="#{msgs.approve_review}" rendered="#{userSession.csd}">
                        <p:menuitem value="#{msgs.register_applicant}" icon="ui-icon-gear"
                                    oncomplete="PF('approveDlg').show()" action="#{processPIPOrderBn.initApprove}"
                                    rendered="#{userSession.csd}"/>
                        <p:menuitem value="#{msgs.global_reject}" icon="ui-icon-gear"
                                    action="#{processPIPOrderBn.rejectOrder}" ajax="false"
                                    rendered="#{userSession.csd}"/>
                    </p:submenu>

                </p:menu>


                <h:panelGroup styleClass="ui-widget">
                    <h1 class="title ui-widget-header ui-corner-all">
                        <table class="banner">
                            <tr>
                                <td>
                                    <h:outputLabel value="#{processPIPOrderBn.pOrderBase.applicant.appName}"
                                                   styleClass="title"
                                                   style="font-weight: bold; font-size: 1.5em"/>
                                </td>
                                <td align="right">
                                    <h:outputLabel value="#{msgs.application_status}: "
                                                   style="font-weight: bold;color: #a52a2a;"/>
                                    <h:outputLabel value="#{msgs[processPIPOrderBn.pOrderBase.state.key]}"
                                                   style="font-weight: bold;color: #a52a2a;"/>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <h:outputLabel value="#{msgs.application_no}: " styleClass="title"/>
                                    <h:outputFormat value="#{processPIPOrderBn.pOrderBase.id}" styleClass="title"/>
                                </td>
                                <td align="right">
                                    <h:outputLabel value="#{msgs.submitted_date}: " styleClass="title"/>
                                    <h:outputFormat value="#{processPIPOrderBn.pOrderBase.submitDate}"/>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                </td>
                                <td align="right">
                                    <h:outputLabel value="#{msgs.review_status}: " rendered="#{not empty processPIPOrderBn.pOrderBase.reviewState}"
                                                   style="font-weight: bold;color: #a52a2a;"/>
                                    <h:outputLabel value="#{msgs[processPIPOrderBn.pOrderBase.reviewState.key]}" rendered="#{not empty processPIPOrderBn.pOrderBase.reviewState}"
                                                   style="font-weight: bold;color: #a52a2a;"/>
                                </td>
                            </tr>
                        </table>
                    </h1>
                    <p:messages id="messages" showDetail="true" showSummary="true"/>

                    <p:growl id="growl" showDetail="true" showSummary="true"/>


                    <p:tabView id="appDetails">
                        <p:tab title="#{msgs.order_detail}">

                            <p:panel header="#{msgs.general_info}">
                                <h:panelGrid columns="4" cellspacing="10" columnClasses="col1, col2, col1, col2">
                                    <p:outputLabel value="#{msgs.ship_inst}" for="shipinst"/>
                                    <p:outputLabel id="shipinst" required="true"
                                                   value="#{processPIPOrderBn.pOrderBase.shippingInstruction}"/>

                                    <p:outputLabel value="#{msgs.portof_entry}" for="port"/>
                                    <p:outputLabel id="port" required="true"
                                                   value="#{processPIPOrderBn.pOrderBase.entryPort}"/>

                                    <p:outputLabel value="#{msgs.delivery}" for="delivery"/>
                                    <p:outputLabel id="delivery" required="true"
                                                   value="#{processPIPOrderBn.pOrderBase.delivery}"/>

                                    <p:outputLabel value="#{msgs.payment_info}" for="payinfo"/>
                                    <p:outputLabel id="payinfo" required="true"
                                                   value="#{processPIPOrderBn.pOrderBase.paymentMethod}"/>

                                    <p:outputLabel value="#{msgs.global_comment}" for="comment"/>
                                    <p:outputLabel id="comment" value="#{processPIPOrderBn.pOrderBase.comment}"/>

                                </h:panelGrid>

                            </p:panel>

                            <div style="height:10px"/>

                            <p:panel header="#{msgs.product_details}">
                                <h:panelGrid columns="1" cellspacing="10px">
                                    <p:dataTable id="ordertable" var="order"
                                                 value="#{processPIPOrderBn.pOrderBase.pipProds}"
                                                 style="width:100%;">
                                        <f:facet name="header"> #{msgs.product_list}</f:facet>

                                        <p:column headerText="#{msgs.prod_number}">
                                            <h:outputText value="#{order.productNo}"/>
                                        </p:column>

                                        <p:column headerText="#{msgs.prod_name}">
                                            <h:outputText value="#{order.productName}"/>
                                        </p:column>

                                        <p:column headerText="#{msgs.prod_desc}">
                                            <h:outputText value="#{order.productDesc}"/>
                                        </p:column>

                                        <p:column headerText="#{msgs.inn_unit}">
                                            <h:outputText value="#{order.unit}"/>
                                        </p:column>

                                        <p:column headerText="#{msgs.global_quantity}">
                                            <h:outputText value="#{order.quantity}"/>
                                        </p:column>

                                        <p:column headerText="#{msgs.product_pricing}">
                                            <h:outputText value="#{order.unitPrice}"/>
                                        </p:column>

                                        <p:column headerText="#{msgs.total_price}">
                                            <h:outputText value="#{order.totalPrice}"/>
                                        </p:column>
                                    </p:dataTable>
                                </h:panelGrid>


                            </p:panel>

                            <div style="height:10px"/>

                            <p:panel header="#{msgs.applicant_detail}">
                                <ui:decorate template="/templates/applicantdetailtmpl.xhtml">
                                    <ui:param name="applicantdata" value="#{processPIPOrderBn.pOrderBase.applicant}"/>
                                    <ui:param name="input" value="#{false}"/>
                                </ui:decorate>

                            </p:panel>

                            <div style="height:10px"/>

                            <p:panel header="#{msgs.person_responsible}">
                                <ui:decorate template="/templates/userdetailtmpl.xhtml">
                                    <ui:param name="userdata" value="#{processPIPOrderBn.pOrderBase.createdBy}"/>
                                    <ui:param name="input" value="#{false}"/>
                                </ui:decorate>

                            </p:panel>

                            <div style="height:10px"/>

                        </p:tab>

                        <p:tab title="#{msgs.prod_screening}">

                            <h:panelGrid columns="1" style="margin-bottom:10px" cellpadding="10" cellspacing="10">
                                <p:outputLabel value="#{msgs.fee_recieved}" styleClass="label" for="feerecieved"/>
                                <p:selectBooleanButton id="feerecieved"
                                                       value="#{processPIPOrderBn.pOrderBase.feeRecieved}"
                                                       onLabel="#{msgs.global_yes}" offLabel="#{msgs.global_no}"
                                                       onIcon="ui-icon-check"
                                                       offIcon="ui-icon-close" style="width:60px">
                                    <p:ajax update=":reghome:growl :reghome"
                                            listener="#{processPIPOrderBn.feeRecievedListener}"/>
                                </p:selectBooleanButton>
                            </h:panelGrid>

                            <div style="height:10px"/>

                            <p:panel header="#{msgs.checklist}">
                                <p:dataTable var="checkList" value="#{processPIPOrderBn.pOrderChecklists}"
                                             style="width:100%;">
                                    <p:column headerText="" colspan="3" rendered="#{checkList.pipOrderLookUp.header}"
                                              style="background-color: bisque;font-weight: bolder;">
                                        <h:outputLabel value="#{checkList.pipOrderLookUp.id}"/>
                                    </p:column>
                                    <p:column rendered="#{!checkList.pipOrderLookUp.header}">
                                        <h:outputLabel value="#{checkList.pipOrderLookUp.name}"/>
                                    </p:column>
                                    <p:column rendered="#{!checkList.pipOrderLookUp.header}">
                                        <p:selectBooleanCheckbox value="#{checkList.value}"/>
                                    </p:column>
                                    <p:column rendered="#{!checkList.pipOrderLookUp.header}">
                                        <p:selectBooleanCheckbox value="#{checkList.staffValue}"/>
                                    </p:column>
                                </p:dataTable>
                            </p:panel>

                            <div style="height:10px"/>
                        </p:tab>

                        <p:tab title="#{msgs.attachments}">

                            <p:panel header="#{msgs.attachments}">
                                <p:commandButton icon="ui-icon-document" value="#{msgs.adddocument}"
                                                 oncomplete="PF('attachdlg').show()"
                                                 action="#{processPIPOrderBn.prepareUpload}"
                                                 update=":attachdlg" id="addDocBtn"/>

                                <p:dataTable id="attachtable" value="#{processPIPOrderBn.pOrderDocs}" var="doc">

                                    <p:column headerText="#{msgs.title}">
                                        <h:outputText value="#{doc.title}"/>
                                    </p:column>

                                    <p:column headerText="#{msgs.filename}">
                                        <h:outputText value="#{doc.fileName}"/>
                                    </p:column>

                                    <p:column headerText="#{msgs.uploaddate}">
                                        <h:outputText converter="javax.faces.DateTime" value="#{doc.createdDate}"/>
                                    </p:column>

                                    <p:column headerText="#{msgs.uploadedby}">
                                        <h:outputText value="#{doc.uploadedBy.name}"/>
                                    </p:column>

                                    <p:column headerText="#{msgs.registration_status}">
                                        <h:outputText value="#{msgs[doc.regState.key]}"/>
                                    </p:column>

                                    <p:column>
                                        <p:commandButton id="downloadLink" value="Download" ajax="false"
                                                         onclick="PrimeFaces.monitorDownload(start, stop)"
                                                         icon="ui-icon-arrowthichk-n">
                                            <p:fileDownload value="#{processPIPOrderBn.fileDownload(doc)}"/>
                                        </p:commandButton>
                                    </p:column>

                                    <p:column>
                                        <p:commandButton id="deleteattach"
                                                         action="#{processPIPOrderBn.deleteDoc(doc)}" ajax="false"
                                                         icon="ui-icon-trash"
                                                         update=":reghome:attachtab:attachtable"/>
                                    </p:column>
                                </p:dataTable>

                            </p:panel>


                            <div style="height:10px"/>
                        </p:tab>
                        <p:tab title="#{msgs.global_comment}">
                            <p:dataTable id="commenttable" value="#{processPIPOrderBn.pOrderComments}" var="it">
                                <p:column style="width:120px;">
                                    <p:outputLabel styleClass="ui-icon ui-icon-comment"
                                                   style="display:inline-block;"/>
                                    <p:outputLabel value="#{it.user.name}" styleClass="label"/>

                                    <div style="font-size: smaller;">
                                        <h:outputLabel converter="javax.faces.DateTime" value="#{it.date}"/>
                                    </div>
                                </p:column>

                                <p:column>
                                    <div style="padding-left:10px;padding-top:10px;">
                                        <h:outputText value="#{it.comment}"
                                                      escape="false"
                                                      styleClass="text"/>
                                    </div>
                                </p:column>
                                <p:column>
                                    #{it.recomendType}
                                </p:column>
                            </p:dataTable>


                        </p:tab>

                    </p:tabView>

                </h:panelGroup>
            </h:panelGrid>
        </h:form>
        <p:dialog header="#{msgs.adddocument}" widgetVar="attachdlg" resizable="false" id="attachdlg"
                  modal="true" dynamic="true">
            <h:form prependId="false">
                <h:panelGrid columns="2" style="margin-bottom:10px">
                    <p:outputLabel for="attachtitle" value="#{msgs.title}"/>
                    <p:inputText id="attachtitle" value="#{processPIPOrderBn.pOrderDoc.title}"/>
                    <h:outputLabel for="attachcomment" value="#{msgs.global_comment}"/>
                    <p:inputTextarea id="attachcomment" value="#{processPIPOrderBn.pOrderDoc.comment}"
                                     rows="5" cols="50"/>
                </h:panelGrid>

                <p:fileUpload fileUploadListener="#{processPIPOrderBn.handleFileUpload}"
                              mode="advanced" auto="true"
                              update=":reghome:growl :reghome:messages"
                              multiple="false"
                              sizeLimit="10000000">

                </p:fileUpload>

                <p:commandButton id="adddoc" value="#{msgs.global_submit}"
                                 action="#{processPIPOrderBn.addDocument}"
                                 oncomplete="PF('attachdlg').hide()"
                                 update=":reghome:growl :reghome:messages :reghome"/>
            </h:form>
        </p:dialog>
        <p:dialog header="#{msgs.complete_review}" widgetVar="reviewDlg" id="reviewDlg"
                  modal="true" dynamic="true">
            <h:form prependId="false">
                <h:panelGrid columns="3" style="margin-bottom:10px">
                <p:outputLabel value="#{msgs.recommendation}" for="recomcb" styleClass="label"/>
                <p:selectOneMenu id="recomcb" value="#{processPIPOrderBn.pOrderComment.recomendType}" required="true"
                                 requiredMessage="#{msgs.recommendation_valid}">
                    <f:selectItem itemLabel="-"/>
                    <f:selectItems value="#{globalLists.recomendType}" var="type" itemLabel="#{msgs[type.key]}"/>
                </p:selectOneMenu>
                    <p:message for="recomcb"/>

                <p:outputLabel value="#{msgs.reviewer_summary}" for="revsummary" styleClass="label"/>
                <p:editor value="#{processPIPOrderBn.pOrderComment.comment}" id="revsummary" required="true"
                          width="700" />
                    <p:message for="revsummary"/>
                </h:panelGrid>
                <p:commandButton value="#{msgs.global_submit}" action="#{processPIPOrderBn.submitComment}" oncomplete="PF('reviewDlg').hide()" ajax="false"/>
            </h:form>
        </p:dialog>

        <p:dialog header="#{msgs.complete_review}" widgetVar="approveDlg" id="approveDlg"
                  modal="true" dynamic="true">
            <h:form prependId="false">
                <h:panelGrid columns="3" style="margin-bottom:10px" cellpadding="10" cellspacing="10">
                    <p:outputLabel value="#{msgs.recommendation}" for="recomcb" styleClass="label"/>
                    <p:outputLabel value="#{processPIPOrderBn.pOrderComment.recomendType}" styleClass="label"/>
                    <p:message for="recomcb"/>

                    <p:outputLabel value="#{msgs.reviewer_summary}" for="approvecomment" styleClass="label"/>
                    <p:editor value="#{processPIPOrderBn.pOrderComment.comment}" id="approvecomment" required="true"
                              width="700" />
                    <p:message for="approvecomment"/>
                </h:panelGrid>
                <p:commandButton value="#{msgs.global_submit}" action="#{processPIPOrderBn.approveOrder}" oncomplete="PF('approveDlg').hide()" update=":reghome"/>
            </h:form>
        </p:dialog>
    </ui:define>
</ui:composition>
