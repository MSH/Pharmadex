<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://java.sun.com/jsf/core"
                template="../templates/process_reg_layout.xhtml">
    <ui:define name="content">

        <h:form id="reghome">


            <h:panelGrid columns="1" cellpadding="10px">

                <h:panelGroup styleClass="ui-widget">
                    <h1 class="title ui-widget-header ui-corner-all">
                        <table class="banner">
                            <tr>
                                <td>
                                    <h:outputLabel value="#{licHolderBn.licenseHolder.name}" styleClass="title"
                                                   style="font-weight: bold; font-size: 1.5em"/>
                                </td>
                                <td align="right">
                                    <h:outputLabel value="#{msgs.applicant_country}: "
                                                   style="font-weight: bold;color: #a52a2a;"/>
                                    <h:outputLabel value="#{licHolderBn.licenseHolder.address.country}"
                                                   style="font-weight: bold;color: #a52a2a;"/>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <h:outputLabel value="#{msgs.application_no}: " styleClass="title"/>
                                    <h:outputFormat value="#{licHolderBn.licenseHolder.id}" styleClass="title"/>
                                </td>
                                <td align="right">
                                    <h:outputLabel value="#{msgs.submitted_date}: " styleClass="title"/>
                                    <h:outputFormat value="#{licHolderBn.licenseHolder.createdDate}"/>
                                </td>
                            </tr>
                        </table>
                    </h1>
                    <p:messages id="messages" showSummary="true"/>

                    <p:growl id="growl" showSummary="true"/>

                    <h:panelGrid columns="3">
                        <p:commandButton value="#{msgs.global_update}" icon="ui-icon-pencil"
                                         action="#{licHolderBn.sentToDetail}" ajax="false"></p:commandButton>
                        <p:commandButton value="#{msgs.global_suspend}" icon="ui-icon-cancel"
                                         action="#{licHolderBn.suspend}" ajax="false"
                                         rendered="#{licHolderBn.licenseHolder.state eq 'ACTIVE'}"></p:commandButton>
                        <p:commandButton value="#{msgs.global_activate}" icon="ui-icon-check"
                                         action="#{licHolderBn.activate}" ajax="false"
                                         rendered="#{licHolderBn.licenseHolder.state eq 'BLOCKED'}"></p:commandButton>
                        <p:commandButton value="#{msgs.global_back}" icon="ui-icon-circle-triangle-w"
                                         action="#{licHolderBn.back}" ajax="false" immediate="true"/>

                    </h:panelGrid>

                    <p:panel header="#{msgs.lic_holder_detail}">
                        <ui:decorate template="/templates/licholderdetailtmpl.xhtml">
                            <ui:param name="licholderdata" value="#{licHolderBn.licenseHolder}"/>
                            <ui:param name="input" value="false"/>
                        </ui:decorate>

                    </p:panel>

                    <p:panel header="#{msgs.agentList}">

                        <h:panelGrid columns="2" cellpadding="10px">
                            <p:commandButton value="#{msgs.global_add}" oncomplete="PF('addAgentDlg').show()"
                                             icon="ui-icon-circle-plus" update=":addAgentFrm :message"/>

                        </h:panelGrid>


                        <p:dataTable id="agents" var="agentInfo" value="#{licHolderBn.agentInfos}">
                            <p:column sortBy="#{agentInfo.agentType}">
                                <f:facet name="header">
                                    <h:outputText value="#{msgs.agent_type}"/>
                                </f:facet>
                                <p:commandLink id="viewLink" value="#{agentInfo.agentType}" oncomplete="PF('addAgentDlg').show()" action="#{licHolderBn.initEdit(agentInfo)}"
                                               update=":addAgentdlg" style="#{agentInfo.active ?'color: #006600;':''}">
                                </p:commandLink>
                            </p:column>

                            <p:column sortBy="#{agentInfo.applicant.appName}">
                                <f:facet name="header">
                                    <h:outputText value="#{msgs.registration_applicant}"/>
                                </f:facet>
                                <h:outputText value="#{agentInfo.applicant.appName}"/>
                            </p:column>

                            <p:column sortBy="#{agentInfo.startDate}">
                                <f:facet name="header">
                                    <h:outputText value="#{msgs.global_startdate}"/>
                                </f:facet>
                                <h:outputLabel converter="javax.faces.DateTime"
                                               value="#{agentInfo.startDate}"/>
                            </p:column>

                            <p:column sortBy="#{agentInfo.endDate}">
                                <f:facet name="header">
                                    <h:outputText value="#{msgs.global_enddate}"/>
                                </f:facet>
                                <h:outputLabel converter="javax.faces.DateTime"
                                               value="#{agentInfo.endDate}"/>
                            </p:column>

                            <p:column sortBy="#{agentInfo.createdDate}">
                                <f:facet name="header">
                                    <h:outputText value="#{msgs.global_createdate}"/>
                                </f:facet>
                                <h:outputLabel converter="javax.faces.DateTime"
                                               value="#{agentInfo.createdDate}"/>
                            </p:column>
                            <p:column sortBy="#{agentInfo.createdBy.name}">
                                <f:facet name="header">
                                    <h:outputText value="#{msgs.created_by}"/>
                                </f:facet>
                                <h:outputText value="#{agentInfo.createdBy.name}"/>
                            </p:column>
                        </p:dataTable>

                    </p:panel>

                    <p:panel header="#{msgs.product_list}">
                        <p:dataTable id="products" var="prodApps" value="#{licHolderBn.products}">
                            <p:column sortBy="#{prodApps.prodName}">
                                <f:facet name="header">
                                    <h:outputText value="#{msgs.prodName}"/>
                                </f:facet>
                                <p:commandLink id="viewLink" value="#{prodApps.prodName}"
                                               action="#{applicantHome.sentToDetail(prodApps.id)}"
                                               ajax="false">
                                    <f:param name = "licHolderID" value="#{licHolderBn.licenseHolder.id}"/>
                                </p:commandLink>
                            </p:column>

                            <p:column sortBy="#{prodApps.genName}">
                                <f:facet name="header">
                                    <h:outputText value="#{msgs.prodgenname}"/>
                                </f:facet>
                                <h:outputText value="#{prodApps.genName}"/>
                            </p:column>

                            <p:column sortBy="#{prodApps.dosForm.dosForm}">
                                <f:facet name="header">
                                    <h:outputText value="#{msgs.dos_form}"/>
                                </f:facet>
                                <h:outputText value="#{prodApps.dosForm.dosForm}"/>
                            </p:column>

                            <p:column sortBy="#{prodApps.dosStrength}">
                                <f:facet name="header">
                                    <h:outputText value="#{msgs.dos_strength}"/>
                                </f:facet>
                                <h:outputText value="#{prodApps.dosStrength}"/>
                            </p:column>

                        </p:dataTable>
                    </p:panel>

                </h:panelGroup>
            </h:panelGrid>

        </h:form>

        <p:dialog header="#{msgs.global_add}" widgetVar="addAgentDlg" id="addAgentdlg" resizable="true" closable="false" modal="true">
            <p:messages id="message" />
            <h:form id="addAgentFrm">
                <h:panelGrid columns="2" cellspacing="5" columnClasses="label, value" styleClass="grid">
                    <h:outputLabel value="#{msgs.applicant_name}" for="applicant"/>
                    <p:autoComplete id="applicant" value="#{licHolderBn.agentInfo.applicant}" rendered="#{empty licHolderBn.agentInfo.id}"
                                    completeMethod="#{licHolderBn.completeApplicantList}" dropdown="true"
                                    var="it" itemLabel="#{it.appName}" itemValue="#{it.applcntId}" forceSelection="true"
                                    converter="#{applicantConverter}">
                    </p:autoComplete>
                    <p:outputLabel value="#{licHolderBn.agentInfo.applicant.appName}" rendered="#{not empty licHolderBn.agentInfo.id}"/>

                    <p:outputLabel value="#{msgs.agent_type}" for="forAgentTypecb"
                                   styleClass="fy-required-field"/>
                    <p:selectOneMenu id="forAgentTypecb" value="#{licHolderBn.agentInfo.agentType}"
                                     required="true">
                        <f:selectItem itemLabel="-" itemValue=""/>
                        <f:selectItems value="#{globalListsET.agentTypes}" var="agenttype"
                                       itemLabel="#{msgs[agenttype.key]}"/>
                    </p:selectOneMenu>

                    <p:outputLabel value="#{msgs.registration_date}" for="startDate"/>
                    <p:calendar id="startDate" value="#{licHolderBn.agentInfo.startDate}" showOn="button"
                                required="true">
                    </p:calendar>
                    <p:outputLabel value="#{msgs.expiry_date}"/>
                    <p:calendar value="#{licHolderBn.agentInfo.endDate}" id="expiryDate" showOn="button"
                                required="true"/>

                    <h:panelGroup>
                        <p:commandButton action="#{licHolderBn.updateAgent}" value="#{msgs.global_update}" ajax="false" rendered="#{!empty licHolderBn.agentInfo.id}"
                                         update=":reghome:agents :addAgentdlg :message :reghome:growl" oncomplete="PF('addAgentDlg').hide()" process="@form"/>
                        <p:commandButton action="#{licHolderBn.addAgent}" value="#{msgs.global_add}" ajax="false" rendered="#{empty licHolderBn.agentInfo.id}"
                                         update=":reghome:agents :addAgentdlg :message :reghome:growl" />
                        <p:commandButton action="#{licHolderBn.cancelAddAgent}" immediate="true" ajax="false"
                                         value="#{msgs.global_cancel}" oncomplete="PF('addAgentDlg').hide()"/>
                    </h:panelGroup>
                    <h:outputLabel/>

                </h:panelGrid>
            </h:form>
        </p:dialog>



    </ui:define>
</ui:composition>
