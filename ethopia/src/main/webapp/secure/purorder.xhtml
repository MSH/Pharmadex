<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui" xmlns:f="http://java.sun.com/jsf/core"
                template="../templates/admin_layout.xhtml">
    <ui:define name="content">
        <div class="post" style="width: 1024px">
            <h1 class="title ui-widget-header ui-corner-all"> #{msgs.purorder}</h1>
        </div>

        <h:form prependId="false" id="reghome">
            <p:growl id="growl"/>
            <p:messages id="messages" showDetail="true"/>

            <ui:decorate template="appinfosub.xhtml">
                <ui:param name="regHomeData" value="#{purOrderBn}"/>
                <ui:param name="appSelectData" value="#{pOAppSelectBn}"/>
                <ui:param name="displayLH" value="false"/>
            </ui:decorate>

            <div style="height:10px"/>

            <p:panel header="#{msgs.general_info}">
                <h:panelGrid columns="3" cellspacing="10" columnClasses="col1, col2, col3">
                    <p:outputLabel value="#{msgs.ship_inst}" for="shipinst"/>
                    <p:inputText id="shipinst" required="true" value="#{purOrderBn.purOrder.shippingInstruction}" readonly="#{not empty purOrderBn.purOrder.submitDate}"/>
                    <p:message for="shipinst" showSummary="true"/>


                    <p:outputLabel value="#{msgs.portof_entry}" for="port"/>
                    <p:inputText id="port" required="true" readonly="#{not empty purOrderBn.purOrder.submitDate}"
                                 value="#{purOrderBn.purOrder.entryPort}"/>
                    <p:message for="port" showSummary="true"/>

                    <p:outputLabel value="#{msgs.delivery}" for="delivery"/>
                    <p:inputText id="delivery" required="true" value="#{purOrderBn.purOrder.delivery}" readonly="#{not empty purOrderBn.purOrder.submitDate}"/>
                    <p:message for="delivery" showSummary="true"/>

                    <p:outputLabel value="#{msgs.payment_info}" for="payinfo"/>
                    <p:inputText id="payinfo" required="true" value="#{purOrderBn.purOrder.paymentMethod}" readonly="#{not empty purOrderBn.purOrder.submitDate}"/>
                    <p:message for="payinfo" showSummary="true"/>

                    <p:outputLabel value="#{msgs.global_comment}" for="comment"/>
                    <p:inputText id="comment" value="#{purOrderBn.purOrder.comment}" readonly="#{not empty purOrderBn.purOrder.submitDate}"/>
                    <p:message for="comment" showSummary="true"/>

                </h:panelGrid>

            </p:panel>

            <div style="height:10px"/>

            <p:panel header="#{msgs.product_details}">
                <h:panelGrid columns="1" cellspacing="10px">
                    <p:outputLabel
                            value="Please specify all the products that will imported as part of this order by clicking the add button"
                            styleClass="hint"/>

                    <p:dataTable id="ordertable" var="order" value="#{purOrderBn.purProds}" style="width:100%;">
                        <f:facet name="header">
                            <p:commandButton value="#{msgs.global_add}" oncomplete="PF('orderdetailDlg').show()" 
                                             rendered="#{empty purOrderBn.purOrder.submitDate}"
                                             action="#{purOrderBn.initAddProd}" process="@this" update=":orderdetailfrm" />
                        </f:facet>

                        <p:column headerText="#{msgs.prod_name}">
                            <h:outputText value="#{order.productName}"/>
                        </p:column>

                        <p:column headerText="#{msgs.dos_strength}">
                            <h:outputText value="#{order.dosStrength}"/>
                        </p:column>

                        <p:column headerText="#{msgs.dos_unit}">
                            <h:outputText value="#{order.dosUnit.uom}"/>
                        </p:column>

                        <p:column headerText="#{msgs.dos_form}">
                            <h:outputText value="#{order.dosForm.dosForm}"/>
                        </p:column>


                        <p:column headerText="#{msgs.prod_presentation}">
                            <h:outputText value="#{order.productDesc}"/>
                        </p:column>

                        <p:column headerText="#{msgs.global_quantity}">
                            <h:outputText value="#{order.quantity}"/>
                        </p:column>

                        <p:column headerText="#{msgs.product_pricing}">
                            <h:outputText value="#{order.unitPrice}"/>
                        </p:column>

                        <p:column headerText="#{msgs.total_price}">
                            <h:outputText value="#{order.totalPrice}"/>
                        </p:column>

                        <p:column rendered="#{empty order.purOrder.submitDate}">
                            <p:commandButton action="#{purOrderBn.removeProd(order)}" value="#{msgs.global_delete}"
                                             update=":reghome:ordertable :reghome:growl" immediate="true">
                            </p:commandButton>
                        </p:column>

                    </p:dataTable>

                </h:panelGrid>



            </p:panel>

            <div style="height:10px"/>

            <p:panel header="#{msgs.attachments}">
                <p:commandButton icon="ui-icon-document" value="#{msgs.adddocument}"
                                 oncomplete="PF('attachdlg').show()" rendered="#{empty purOrderBn.purOrder.submitDate}"
                                 action="#{purOrderBn.prepareUpload}"
                                 update=":attachdlg" id="addDocBtn"/>

                <p:dataTable id="attachtable" value="#{purOrderBn.pOrderDocs}" var="doc">

                    <p:column headerText="#{msgs.title}">
                        <h:outputText value="#{doc.title}"/>
                    </p:column>

                    <p:column headerText="#{msgs.filename}">
                        <h:outputText value="#{doc.fileName}"/>
                    </p:column>

                    <p:column headerText="#{msgs.uploaddate}">
                        <h:outputText converter="javax.faces.DateTime" value="#{doc.createdDate}"/>
                    </p:column>

                    <p:column headerText="#{msgs.uploadedby}">
                        <h:outputText value="#{doc.uploadedBy.name}"/>
                    </p:column>

                    <p:column headerText="#{msgs.registration_status}">
                        <h:outputText value="#{msgs[doc.regState.key]}"/>
                    </p:column>

                    <p:column>
                        <p:commandButton id="downloadLink" value="Download" ajax="false"
                                         onclick="PrimeFaces.monitorDownload(start, stop)"
                                         icon="ui-icon-arrowthichk-s">
                            <p:fileDownload value="#{purOrderBn.fileDownload(doc)}"/>
                        </p:commandButton>
                    </p:column>

                    <p:column rendered="#{empty purOrderBn.purOrder.submitDate}">
                        <p:commandButton id="deleteattach"
                                         action="#{purOrderBn.deleteDoc(doc)}" ajax="false"
                                         icon="ui-icon-trash"
                                         update=":reghome:attachtab:attachtable"/>
                    </p:column>
                </p:dataTable>

            </p:panel>

            <p:panel header="#{msgs.checklist}">
                <p:dataTable var="checkList" value="#{purOrderBn.pOrderChecklists}" style="width:100%;">
                    <p:column headerText="" colspan="3" rendered="#{checkList.pipOrderLookUp.header}" style="background-color: bisque;font-weight: bolder;">
                        <h:outputLabel value="#{checkList.pipOrderLookUp.name}"/>
                    </p:column>
                    <p:column rendered="#{!checkList.pipOrderLookUp.header}">
                        <h:outputLabel value="#{checkList.pipOrderLookUp.no}"/>
                    </p:column>
                    <p:column rendered="#{!checkList.pipOrderLookUp.header}">
                        <h:outputLabel value="#{checkList.pipOrderLookUp.name}"/>
                    </p:column>
                    <p:column rendered="#{!checkList.pipOrderLookUp.header and empty checkList.purOrder.submitDate}">
                        <p:selectOneButton id="console" value="#{checkList.value}" rendered="#{checkList.pipOrderLookUp.optional}">
                            <f:selectItems value="#{globalLists.yesNoNA}" var="value" itemLabel="#{msgs[value.key]}" />
                        </p:selectOneButton>
                        <p:selectOneButton id="console2" value="#{checkList.value}" rendered="#{!checkList.pipOrderLookUp.optional}">
                            <f:selectItems value="#{globalLists.yesNo}" var="value" itemLabel="#{msgs[value.key]}" />
                        </p:selectOneButton>
                    </p:column>
                    <p:column rendered="#{!checkList.pipOrderLookUp.header and not empty checkList.purOrder.submitDate}">
                        <h:outputLabel value="#{msgs[checkList.value.key]}"/>
                    </p:column>
                </p:dataTable>
            </p:panel>


            <div align="center" style="height: 60px">
                <p:commandButton value="#{msgs.global_submit}" rendered="#{empty purOrderBn.purOrder.submitDate}"
                                 oncomplete="if (!args.validationFailed) PF('confirmDlg').show()"
                                 update="messages growl"/>
                <p:commandButton action="#{purOrderBn.cancelOrder}" value="#{msgs.global_cancel}" ajax="false"
                                 immediate="true"/>
            </div>

        </h:form>

        <p:dialog header="#{msgs.global_agreement}" widgetVar="confirmDlg" id="confirmdlg" resizable="true"
                  modal="true" dynamic="true">
            <h:form>
                <div>
                    <p>
                        <ol>
                            <li>Products should have minimum 75% of its shelf life on arrival at Addis Ababa/port of entry.</li>
                            <li>Language used for writing label, leaflet and other documents shall be in English</li>
                            <li>All packing should be suitable for road, air and sea transport under tropical conditions</li>
                            <li>
                                The label of immediate container:-
                                <ul>
                                    <li>The name of the product, brand and generic/INN</li>
                                    <li>Pharmaceutical dosage form and route of administration</li>
                                    <li>Qualitative and quantitative composition of active ingredient(s)</li>
                                    <li>Quantity in container, technical directions for use</li>
                                    <li>Handling and storage requirements</li>
                                    <li>Batch number, manufacturing and expiry date</li>
                                    <li>Name and address of the company</li>
                                </ul>
                            </li>
                            <li>Accompanying invoices should be as per the purchase order including Batch number, manufacturing and expiry date of each item</li>
                            <li>Every product should be accompanied by a leaflet in its immediate container. A leaflet must bear adequate information for use and it should at least include:
                                <ul>
                                    <li>The name of the product: brand and generic/INN</li>
                                    <li>Description appearance, pharmaceutical dosage form and route of administration</li>
                                    <li>Qualitative and quantitative composition of active ingredients</li>
                                    <li>Clinical pharmacology, indication(s), warning, precautions, contraindications, adverse reactions/side effects</li>
                                    <li>Dosage and administration (direction for use)</li>
                                    <li>Over dosage, storage instruction, package quantity, name and address of manufacturer.</li>
                                </ul>
                            </li>
                        </ol>
                    </p>
                </div>
                <p:commandButton value="#{msgs.global_yes}" styleClass="ui-confirmdialog-yes"
                                 icon="ui-icon-check"
                                 action="#{purOrderBn.saveOrder}" ajax="false" oncomplete="PF('confirmDlg').hide()"/>
                <p:commandButton value="#{msgs.global_no}" styleClass="ui-confirmdialog-no"
                                 action="#{purOrderBn.cancelOrder}"
                                 icon="ui-icon-close" immediate="true" oncomplete="PF('confirmDlg').hide()"/>
            </h:form>
        </p:dialog>

        <p:dialog header="#{msgs.order_detail}" widgetVar="orderdetailDlg" id="orderdetaildlg" resizable="true" modal="true" dynamic="true">
            <h:form id="orderdetailfrm">
                <p:growl showSummary="true"/>
                <p:messages/>
                <h:panelGrid columns="3" cellpadding="5">
                </h:panelGrid>

                <h:panelGrid columns="4" cellspacing="10" columnClasses="col1, col2, col1, col2" id="search_prod">
                    <h:outputLabel value="#{msgs.search_prod}: " for="basicPojo"/>
                    <p:autoComplete value="#{purOrderBn.product}" id="basicPojo" dropdown="true"
                                    completeMethod="#{purOrderBn.completeProduct}"
                                    var="p" itemLabel="#{p.prodName}" itemValue="#{p.id}"
                                    converter="#{productConverter}"
                            >
                        <p:ajax event="itemSelect"
                                update="orderdetailfrm"
                                listener="#{purOrderBn.appChangeListenener}" partialSubmit="true" process="@this" />
                        <p:ajax event="change" listener="#{purOrderBn.appChangeListenener}"
                                update="orderdetailfrm"
                                partialSubmit="true" process="@this"/>

                    </p:autoComplete>
                    </h:panelGrid>



                <h:panelGrid columns="3" cellspacing="10" columnClasses="col1, col2, col3" id="order_detail">

                    <p:outputLabel value="#{msgs.reg_number}" for="prodnum"/>
                    <p:outputLabel id="prodnum" required="true" value="#{purOrderBn.product.regNo}" />
                    <p:message for="prodnum" showSummary="true"/>

                    <p:outputLabel value="#{msgs.prod_name}" for="prodname"/>
                    <p:outputLabel id="prodname" required="true" value="#{purOrderBn.purProd.productName}" />
                    <p:message for="prodname" showSummary="true"/>

                    <p:outputLabel value="#{msgs.dos_form}" for="dosForm"/>
                    <p:outputLabel id="dosForm" required="true" value="#{purOrderBn.purProd.dosForm.dosForm}" />
                    <p:message for="dosForm" showSummary="true" showDetail="false"/>

                    <p:outputLabel value="#{msgs.dos_unit}" for="dosUnit"/>
                    <p:outputLabel id="dosUnit" required="true" value="#{purOrderBn.purProd.dosUnit}" />
                    <p:message for="dosUnit" showSummary="true" showDetail="false"/>

                    <p:outputLabel value="#{msgs.prod_presentation}" for="proddesc"/>
                    <p:outputLabel id="proddesc" required="true" value="#{purOrderBn.purProd.productDesc}" />
                    <p:message for="proddesc" showSummary="true"/>

                    <p:outputLabel value="#{msgs.product_shelflife}" for="shelflife"/>
                    <p:outputLabel id="shelflife" value="#{purOrderBn.purProd.shelfLife}"/>
                    <p:message for="shelflife" showSummary="true" showDetail="false"/>

                    <p:outputLabel value="#{msgs.dos_strength}" for="dosStrength"/>
                    <p:inputText id="dosStrength" value="#{purOrderBn.purProd.dosStrength}" title="DosStrength"
                                 required="true" requiredMessage="#{msgs.dos_strength}: Value required">
                    </p:inputText>
                    <p:message for="dosStrength" severity="error" showSummary="true" showDetail="false"/>

                    <p:outputLabel value="#{msgs.manuf_name}" for="manufName"/>
                    <p:inputText id="manufName" value="#{purOrderBn.purProd.manufName}"/>
                    <p:message for="manufName" showSummary="true" showDetail="false"/>

                    <p:outputLabel value="#{msgs.pharmacy_address}" for="manufSite"/>
                    <p:inputText id="manufSite" value="#{purOrderBn.purProd.manufSite}"/>
                    <p:message for="manufSite" showSummary="true" showDetail="false"/>

                    <p:outputLabel value="#{msgs.global_quantity}" for="quant"/>
                    <p:inputText id="quant" required="true" value="#{purOrderBn.purProd.quantity}" >
                        <p:ajax event="blur" update =":orderdetailfrm:total" process="@form" listener="#{purOrderBn.calculateTotalPrice}"></p:ajax>
                    </p:inputText>
                    <p:message for="quant" showSummary="true"/>

                    <p:outputLabel value="#{msgs.product_pricing}" for="price"/>
                    <p:inputText id="price" required="true" value="#{purOrderBn.purProd.unitPrice}" >
                        <p:ajax event="blur" update =":orderdetailfrm:total" process="@form" listener="#{purOrderBn.calculateTotalPrice}"></p:ajax>
                    </p:inputText>
                    <p:message for="price" showSummary="true"/>

                    <p:outputLabel value="#{msgs.total_price}" for="total"/>
                    <p:outputLabel id="total" value="#{purOrderBn.purProd.totalPrice}"  styleClass="label"/>

                </h:panelGrid>

                <h:panelGroup>
                    <p:commandButton action="#{purOrderBn.addProd}"
                                     value="#{msgs.global_add}"
                                     oncomplete="if (!args.validationFailed) PF('orderdetailDlg').hide()"
                                     process="@form" update=":reghome:ordertable"/>
                    <p:commandButton action="#{purOrderBn.cancelAddProd}" immediate="true" ajax="true"
                                     value="#{msgs.global_cancel}" oncomplete="PF('orderdetailDlg').hide()"/>
                </h:panelGroup>

            </h:form>
        </p:dialog>

        <p:dialog header="#{msgs.adddocument}" widgetVar="attachdlg" resizable="false" id="attachdlg"
                  modal="true" dynamic="true">
            <h:form prependId="false">
                <h:panelGrid columns="2" style="margin-bottom:10px">
                    <p:outputLabel for="attachtitle" value="#{msgs.title}"/>
                    <p:inputText id="attachtitle" value="#{purOrderBn.pOrderDoc.title}"/>
                    <h:outputLabel for="attachcomment" value="#{msgs.global_comment}"/>
                    <p:inputTextarea id="attachcomment" value="#{purOrderBn.pOrderDoc.comment}"
                                     rows="5" cols="50"/>
                </h:panelGrid>

                <p:fileUpload fileUploadListener="#{purOrderBn.handleFileUpload}"
                              mode="advanced" auto="true"
                              update=":reghome:growl :reghome:messages"
                              multiple="false"
                              sizeLimit="10000000">

                </p:fileUpload>

                <p:commandButton id="adddoc" value="#{msgs.global_submit}"
                                 action="#{purOrderBn.addDocument}"
                                 oncomplete="PF('attachdlg').hide()" update=":reghome:growl :reghome:messages :reghome"/>
            </h:form>
        </p:dialog>

    </ui:define>
</ui:composition>
