<!--
    Created by Odissey 16/03/2016
    It creates  list of products from approved pre-import orders
-->
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui" xmlns:f="http://java.sun.com/jsf/core"
                xmlns:o="http://omnifaces.org/ui"
                template="../templates/admin_layout.xhtml">
    <ui:define name="content">
        <div class="post">
            <h1 class="title ui-widget-header ui-corner-all"> #{msgs.piporderreport}</h1>
        </div>

        <h:form prependId="false" id="reghome">
            <p:panel header="#{msgs.piprepo_selectionCriterias}">
                <h:panelGrid columns="3" cellspacing="10" columnClasses="col1, col2, col3">
                    <p:outputLabel value="#{msgs.piprepo_choosePeriodStart}" for="repodatestart"/>
                    <p:calendar value="#{pIPReportBean.dateStart}"
                        id="repodatestart" required="true"
                        showOn="button" pattern="#{userAccessMBean.workspace.datePattern}"/>
                    <p:message for="repodatestart" showSummary="true"/>
                    <p:outputLabel value="#{msgs.piprepo_choosePeriodEnd}" for="repodateend"/>
                    <p:calendar value="#{pIPReportBean.dateEnd}"
                                id="repodateend" required="true"
                                showOn="button" pattern="#{userAccessMBean.workspace.datePattern}"/>
                    <p:message for="repodateend" showSummary="true"/>
                    <!-- Applicant (choose and lookup)-->
                    <p:outputLabel value="#{msgs.piprepo_chooseapplicant}" for="repoapp"/>
                    <p:autoComplete id="repoapp" dropdown="true"
                                    value="#{pIPReportBean.selectedApplicant}"
                                    completeMethod="#{pIPReportBean.completeApplicant}"
                                    var="it" itemLabel="#{it.appName}" itemValue="#{it.applcntId}" converter="#{applicantConverter}" forceSelection="false"
                                    minQueryLength="2" maxResults="10"/>
                    <p:message for="repoapp" showSummary="true"/>
                    <p:commandButton action="#{pIPReportBean.startReport}" value="#{msgs.piprepo_start}" ajax="false"/>
                </h:panelGrid>
            </p:panel>
            <!--
            Medicine name( Brand ),PIP number,Registration No,Strength,Dosage Form,Total Price,
            Manufacturer,License Holder,Country of Manufacturer,First agent,Quantity,
            Total Number of PIP approved,Presentation
            -->
            <h:panelGroup rendered="#{not empty pIPReportBean.pipProds}">
                <p:dataTable id="pipprodtable" var="eachprod" value="#{pIPReportBean.pipProds}"
                             rendered="#{not empty pIPReportBean.pipProds}"
                             scrollable="true" resizableColumns="true" draggableColumns="true"
                             paginator="true" rows="10" paginatorPosition="bottom"
                             paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                             rowsPerPageTemplate="20,50,100">

                    <p:column headerText="#{msgs.dos_form}" sortBy="#{eachprod.dosFormName}">
                        <p:outputLabel value="#{eachprod}"/>
                    </p:column>
                    <p:column headerText="#{msgs.prod_name}" >
                         <p:outputLabel value="#{eachprod.productName}"/>
                    </p:column>
                    <p:column headerText="#{msgs.piprepo_regNumber}">
                        <p:outputLabel value="#{eachprod.pipOrder.pipNo}"/>
                    </p:column>
                    <p:column headerText="#{msgs.registrationNo}">
                        <p:outputLabel value="#{eachprod.productNo}"/>
                    </p:column>
                    <p:column headerText="#{msgs.dos_strength}">
                        <p:outputLabel value="#{eachprod.dosStrength}"/>
                    </p:column>
                    <p:column headerText="#{msgs.dos_strength}">
                        <p:outputLabel value="#{eachprod.dosStrength}"/>
                    </p:column>

                    <p:column headerText="#{msgs.total_price}">
                        <h:outputText value="#{eachprod.totalPrice}" style="right: auto">
                            <f:convertNumber type="currency"/>
                        </h:outputText>
                    </p:column>
                    <p:column headerText="#{msgs.manuf_name}">
                        <p:outputLabel value="#{eachprod.manufName}"/>
                    </p:column>
                    <p:column headerText="#{msgs.license_holder}">
                        <p:outputLabel value="TBD"/>
                    </p:column>
                    <p:column headerText="#{msgs.manuf_country}">
                        <p:outputLabel value="#{eachprod.country}"/>
                    </p:column>
                    <p:column headerText="#{msgs.agent_first}">
                        <p:outputLabel value="TBD"/>
                    </p:column>
                    <p:column headerText="#{msgs.global_quantity} ">
                        <h:outputText value="#{eachprod.quantity}"/>
                    </p:column>
                    <p:column headerText="#{msgs.piprepo_ordersamount}">
                        <p:outputLabel value="1"/>
                    </p:column>
                    <p:column headerText="#{msgs.prod_presentation}">
                        <p:outputLabel value="TBD"/>
                    </p:column>
                    <!--
                    <p:summaryRow listener="#{pIPReportBean.onSummaryRow}">
                        <p:column colspan="3" style="text-align:right">
                            <h:outputText value="Totals:" />
                        </p:column>
                        <p:column>
                            <h:outputText value="#{component.parent.attributes.total}" />
                        </p:column>
                    </p:summaryRow>
                    -->
                </p:dataTable>
                <p:separator/>
                <h:panelGrid columns="2" width="100%">
                    <p:panel>
                        <h:commandLink>
                            <p:graphicImage value="/resources/images/excel.png"/>
                            <p:dataExporter type="xls" target="pipprodtable" fileName="#{msgs.pipreport}"/>
                        </h:commandLink>

                        <h:commandLink>
                            <p:graphicImage value="/resources/images/pdf.png"/>
                            <p:dataExporter type="pdf" target="pipprodtable" fileName="#{msgs.pipreport}"/>
                        </h:commandLink>
                    </p:panel>
                </h:panelGrid>
            </h:panelGroup>
        </h:form>
    </ui:define>
</ui:composition>
